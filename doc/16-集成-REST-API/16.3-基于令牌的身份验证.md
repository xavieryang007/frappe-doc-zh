# 16.3 基于令牌的身份验证

## 基于令牌的身份验证 (Token Based Authentication)

> 从 v11.0.3 版本开始可用

HTTP 授权请求头包含用于在服务器上验证用户身份的凭据。它由授权类型（token 或 Basic）和相应的令牌组成。

`Authorization: <类型> <令牌>`

令牌由 api-key 和 api-secret 通过冒号连接组成。

### 生成 API 密钥和 API 密钥

1. 转到用户列表并打开一个用户。
2. 点击"设置"选项卡。（如果看不到选项卡，跳过此步骤）
3. 展开 API 访问部分并点击生成密钥。
4. 你将获得一个包含 API 密钥的弹窗。复制此值并保存在安全的地方（密码管理器）。
5. 你还会在此部分看到另一个字段 "API Key"。

现在，使用这两个密钥你可以认证你的 API 请求。你使用这些密钥发出的每个请求都将记录在你第 1 步选择的用户名下。这也意味着角色将根据此用户进行检查。你也可以为 API 调用创建一个新用户。

### 令牌 (TOKEN)

HTTP 头：

`Authorization: token <api_key>:<api_secret>`

Python 示例：

```python
import requests

url = "http://frappe.local:8000/api/method/frappe.auth.get_logged_user"
headers = {
    'Authorization': "token <api_key>:<api_secret>"
}
response = requests.request("GET", url, headers=headers)
```

### 基础认证 (BASIC)

如果使用 "Basic" 认证方案，凭据是 api_key 和 api_secret 的组合，构造方式如下：

1. 使用冒号连接值 `<api_key>:<api_secret>`
2. 对结果字符串进行 base64 编码。`base64encode(<api_key>:<api_secret>)`

HTTP 头：

`Authorization: Basic base64encode("<api_key>:<api_secret>")`

Python 示例：

```python
import requests
import base64

url = "http://frappe.local:8000/api/method/frappe.auth.get_logged_user"
headers = {
    'Authorization': "Basic %s" % base64.b64encode(<api_key>:<api_secret>)
}
response = requests.request("GET", url, headers=headers)
```

### 访问令牌 (ACCESS TOKEN)

如果使用 OAuth 2 访问令牌来认证请求，令牌是设置 OAuth 2 并生成令牌后由 Frappe 服务器提供的不透明 access_token 字符串。请查看指南 / 集成 / 如何使用 OAuth 2

HTTP 头：

`Authorization: Bearer access_token`

Python 示例：

```python
import requests
import base64

url = "http://frappe.local:8000/api/method/frappe.auth.get_logged_user"
headers = {
    "Authorization": "Bearer %s" % access_token
}
response = requests.request("GET", url, headers=headers)
```

### 进一步资源

* 授权头 (Authorization Header)