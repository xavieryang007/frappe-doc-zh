# 13.8 生成器 (Generators)

## 生成器（Generators）概述

生成器用于将文档（DocType）自动生成对应的网页页面。要设置生成器，需要完成以下步骤：

1. **添加路由字段（route）**：指定页面的访问路径。
2. **添加条件字段（condition field）**：用于控制页面是否可见（如"published"字段）。
3. **在 hooks.py 中注册**：将文档类型添加到 `website_generators` 列表中。
4. **继承 WebsiteGenerator**：控制器类需继承 `frappe.website.website_generator.WebsiteGenerator`。
5. **创建模板文件**：定义页面的 HTML 模板。
6. **自定义上下文（context）**：为模板提供动态数据。
7. **自定义路由和列表视图**：根据需要调整页面显示。

## 示例：创建"Job Opening"页面的生成器

以下以"Job Opening"文档类型为例，详细说明每一步操作：

### 1. 添加字段
在文档类型中添加以下字段：
- `route`：页面路由（必填）。
- `published`：布尔字段，控制页面是否发布。

### 2. 在 hooks.py 中注册生成器
在应用的 `hooks.py` 文件中添加或更新 `website_generators` 列表：
```python
website_generators = ["Item Group", "Item", "Sales Partner", "Job Opening"]
```

### 3. 控制器设置
在 `job_opening.py` 中，让控制器继承 `WebsiteGenerator`，并定义网站属性：
```python
from frappe.website.website_generator import WebsiteGenerator
from frappe import _

class JobOpening(WebsiteGenerator):
    website = frappe._dict(
        template="templates/generators/job_opening.html",
        condition_field="published",
        page_title_field="job_title",
    )

    def get_context(self, context):
        # 设置面包屑导航
        context.parents = [{'name': 'jobs', 'title': _('All Jobs')}]
```

### 4. 创建模板文件
在 `templates/generators/job_opening.html` 中创建页面模板：
```html
{% raw %}{% extends "templates/web.html" %}

{% block breadcrumbs %}
    {% include "templates/includes/breadcrumbs.html" %}
{% endblock %}

{% block header %}
<h1>{{ job_title }}</h1>
{% endblock %}

{% block page_content %}
<div>{{ description }}</div>
<a class="btn btn-primary" href="/job_application?job_title={{ doc.job_title }}">
    {{ _("Apply Now") }}</a>
{% endblock %}{% endraw %}
```

### 5. 自定义列表视图
在控制器中添加 `get_list_context` 方法，定义列表页的标题和介绍：
```python
def get_list_context(context):
    context.title = _("Jobs")
    context.introduction = _('Current Job Openings')
```

---

## 注意事项
- 完成上述步骤后，文档表单中会出现"See in Website"链接，用于预览网页。
- 确保模板路径、字段名称与代码中的配置一致。
- 若需自定义路由或列表样式，可进一步修改控制器和模板。