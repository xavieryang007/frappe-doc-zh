# 12.4 报告打印格式

## 简介

在 Frappe Framework 版本 4.1 中引入了"报告打印格式"。这些是 HTML 模板，可用于将查询报告的数据格式化以便打印。

## 创建新的打印格式

### 文件结构要求

要创建新的打印格式，只需在查询报告所在的文件夹中放置一个 `.html` 文件。文件名应与报告名称相同。

**示例目录结构**：
```
general_ledger/
├── __init__.py
├── general_ledger.html    # 打印格式模板
├── general_ledger.js
├── general_ledger.json
└── general_ledger.py
```

### 具体操作步骤

1. 在报告目录中创建同名的 `.html` 文件
2. 使用模板语法编写 HTML 格式
3. 保存文件后，该报告将支持自定义打印格式

## 模板语法

报告打印格式使用基于 [John Resig 的微模板脚本](http://ejohn.org/blog/javascript-micro-templating/) 的适配版本。如果您熟悉 JavaScript，这种语法非常容易掌握。

### 数据插值（属性输出）

```html
<img src="<%=profile_image_url%>">
<strong><a href="<%=from_user%>"><%=from_user%></a>:</strong> <%=text%>
```

### 循环结构

```html
<% for (var i = 0; i < users.length; i++) { %>
  - <a href="<%=users[i].url%>"><%=users[i].name%></a>
<% } %>
```

### 条件判断

```html
<% if (user.is_active) { %>
  <span class="badge badge-success">活跃</span>
<% } else { %>
  <span class="badge badge-secondary">非活跃</span>
<% } %>
```

> **重要提示**：请勿在模板中使用单引号（'），因为引擎无法有效处理它们。

## 可用数据

在模板中可以访问以下数据对象：

### 1. `data` - 记录数据

- 这是一个记录列表，每条记录都是一个对象
- 属性名由报告中的列标签经过 slugify 处理
- 例如："Posting Date" 列的数据可通过 `posting_date` 访问

### 2. `filters` - 筛选条件

- 包含报告中设置的所有筛选条件
- 可以在模板中根据筛选条件调整显示内容

### 3. `report` - 报告视图对象

- 包含报告的整体信息和配置
- 可用于访问报告元数据

## 可用资源和函数

### 预加载样式表

- [Bootstrap 样式表](http://getbootstrap.com) 已预加载
- 可以直接使用 Bootstrap 的 CSS 类来美化打印格式

### 全局函数

可以使用所有全局函数，包括：

- `fmt_money` - 格式化货币金额
- 日期处理工具（dateutil）
- 其他框架提供的实用函数

### 多语言支持

可翻译的字符串应写为：
```html
<span><%= __("文本") %></span>
```

### 模块引入

可以使用 include 语句引入公共模块：
```html
{% include "templates/includes/formats/common_format" %}
```

## 示例参考

总分类账（General Ledger）报告的打印格式模板可以参考：
- [General Ledger Print Format Template](https://github.com/frappe/erpnext/blob/develop/erpnext/accounts/report/general_ledger/general_ledger.html)

## 最佳实践

### 设计考虑

1. **打印优化**：考虑打印纸张的尺寸和布局
2. **简洁性**：保持打印格式简洁明了
3. **字段选择**：只包含必要的字段信息
4. **格式一致性**：保持与系统中其他打印格式的一致性

### 技术建议

1. **模板复用**：创建可复用的模板组件
2. **错误处理**：在模板中添加适当的错误处理
3. **性能优化**：避免复杂的计算逻辑
4. **测试验证**：在多种情况下测试打印效果

通过使用报告打印格式，您可以创建高度定制化的打印输出，满足特定的业务需求。