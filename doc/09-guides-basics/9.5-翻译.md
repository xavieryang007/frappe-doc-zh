# 9.5 翻译

## 概述

Frappe 框架的翻译系统支持多语言，能够从代码文件、模板、Doctype 等多种来源提取并翻译文本。系统支持服务器端（Python）和客户端（JavaScript）的翻译，翻译字典在运行时被缓存以提升性能。

## 翻译系统概述

### 系统特点
- 支持服务器端（Python）和客户端（JavaScript）的翻译
- 翻译字典在运行时被缓存，提升性能
- 根据用户或请求的语言设置动态加载对应翻译
- 支持Doctype元数据自动翻译

## 翻译来源

可翻译的文本存在于以下来源：

1. **JavaScript 代码文件**（框架和应用）
2. **Python 代码文件**
3. **HTML 模板**
4. **工作区定义**
5. **Doctype**（名称、标签、选项等）
6. 其他多种配置文件

### 代码中标识翻译文本的方式

#### Python 翻译方法
使用 `frappe._()` 方法：

```python
frappe._("需要翻译的字符串 {0}").format(变量)
```

#### JavaScript 翻译方法
使用 `__()` 方法：

```javascript
__("需要翻译的字符串 {0}", [变量])
```

## 语言文件

- 翻译文件存储在各个应用的 `translations` 目录下
- 每个语言对应一个 `.csv` 文件（如 `zh.csv`）
- 语言文件包含原始字符串和对应的翻译文本
- 系统启动时会加载所有应用的翻译词典到内存缓存中

## 翻译流程

### 1. 添加新翻译

#### 步骤一：导出未翻译字符串
使用以下命令导出指定语言（如 `zh`）的未翻译内容到文件：

```bash
bench get-untranslated [语言代码] [导出文件路径]
```

#### 步骤二：翻译字符串
- 将导出的文件内容通过翻译工具进行翻译
- 保持翻译文件与源文件顺序一致
- 确保占位符（如 `{0}`）的结构不变

#### 步骤三：导入翻译内容
使用以下命令将翻译后的内容更新到系统中：

```bash
bench update-translations [语言代码] [源文件路径] [翻译文件路径]
```

### 2. 改进现有翻译

#### 方法一：在线平台
通过 [ERPNext 翻译平台](https://translate.erpnext.com) 在线更新。

#### 方法二：直接编辑
直接编辑各应用下 `translations` 目录中的主翻译文件。

### 3. 添加新语言

#### 步骤一：导出全部字符串
```bash
bench get-untranslated [新语言代码] [路径]
```

#### 步骤二：翻译所有字符串
- 翻译所有字符串，保持顺序一致

#### 步骤三：导入翻译
```bash
bench update-translations [新语言代码] [原文件路径] [翻译文件路径]
```

#### 步骤四：更新语言列表
在以下文件中添加新语言代码：
- `apps/languages.txt`
- `frappe/data/languages.txt`

#### 步骤五：提交更改
- 各应用的 `translations` 目录会生成新语言文件
- 提交并推送至代码库

## 翻译管理方法

### 运行时翻译加载
- 翻译字典在请求时根据用户语言设置加载
- 使用 `frappe._()` 或 `__()` 方法时，系统自动替换为对应语言的文本

### DocType 元数据翻译
- 查询 DocType 时自动附加相应语言的翻译内容
- 标签、选项值等都会根据语言设置显示对应翻译

### 集中化工具
- 使用 `bench` 命令行工具进行导出、导入和更新操作
- 确保翻译内容与代码同步

## 最佳实践

1. **翻译质量**：使用专业翻译工具，确保翻译准确性和自然度
2. **占位符处理**：保持占位符结构不变，确保运行时正确替换
3. **语言一致性**：保持整个应用的语言风格一致
4. **社区贡献**：鼓励通过 Pull Request 将翻译贡献回 ERPNext 社区
5. **定期更新**：随着应用功能更新，及时更新翻译内容

## 注意事项

- 翻译时应保持占位符（如 `{0}`）的结构不变
- 使用命令行工具可高效处理大批量翻译任务
- 翻译文件需要与代码版本同步更新
- 生产环境中需要确保翻译文件正确部署

## 总结

Frappe 框架提供了完整的翻译系统支持，通过简单的命令行工具和代码方法，可以实现多语言应用的快速开发。掌握翻译系统的使用方法对于开发国际化应用至关重要。