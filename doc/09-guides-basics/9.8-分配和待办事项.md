# 9.8 分配和待办事项 (Assignments and Todos)

## 概述

Frappe框架中的"待办事项"（ToDo）文档类型用于帮助用户跟踪和管理分配给自己或他人的任务。待办事项可以独立创建，也可以链接到系统中的其他文档，从而提供一个集中式的任务管理系统。

## 待办事项字段

- **状态**：可为"打开"、"关闭"或"已取消"
- **优先级**：设置为"高"、"中"或"低"（默认为"中"）
- **颜色**：用于视觉识别的可选颜色标签
- **截止日期**：任务应完成的日期
- **描述**：任务的主要内容（必填）
- **参考类型和名称**：指向相关文档的可选链接（例如，特定的问题、线索等）
- **角色**：可选的角色分配
- **分配者**：创建或分配任务的用户
- **分配给**：负责完成任务的用户

## 创建待办事项

待办事项可以通过以下几种方式创建：

### 1. 直接创建
- 导航到"待办事项"列表
- 点击"添加待办事项"按钮
- 填写必填详细信息并保存

### 2. 通过分配功能
- 从任何文档（例如，问题、任务）中，使用"分配给"功能
- 系统将创建一个待办事项并将其链接到该文档

### 3. 通过电子邮件
- 通过适当的设置将电子邮件发送到系统
- 电子邮件内容会自动转换为待办事项（需在 `email_append_to` 设置中配置为ToDo）

### 4. 通过分配规则
- 基于条件设置自动分配
- 当满足条件时，系统会创建待办事项（注意：分配规则不能直接设置在待办事项文档类型本身上）

## 管理待办事项

### 标记为已完成
- 打开待办事项
- 将状态更改为"关闭"
- 保存文档
- **注意**：只有被分配人（"分配给"字段中的用户）才能关闭分配给他们的待办事项。如果其他用户尝试在UI中完成他人的待办事项，系统会显示错误

### 取消待办事项
- 打开待办事项
- 将状态更改为"已取消"
- 保存文档
- 取消与完成不同，它表示任务将不会完成，而不是已经完成

### 截止日期的影响
- 帮助确定任务优先级
- 提供目标完成日期
- 在列表视图中用于排序和筛选待办事项
- 被分配规则用于自动化的截止日期管理
- **注意**：系统不会在截止日期临近或过期时自动发送提醒。如果需要此功能，请考虑创建自定义通知

## 通知

系统在以下情况下发送通知：

### 1. 当文档被分配或分配被取消时
- 被分配人会收到通知
- 通知内容包括任务描述、分配者信息或取消分配的信息

### 2. 全局通知计数器
- 打开的待办事项会影响Frappe界面中的通知计数器
- 该计数器帮助用户一目了然地查看有多少未完成的任务

**注意**：系统不会为临近或过期的待办事项发送自动的电子邮件提醒。

## 权限

- 用户可以看到分配给自己的或由自己创建的待办事项
- 系统管理员有权访问所有待办事项
- "All"角色拥有创建、读取、写入和删除待办事项的权限

## 与其他文档的集成

当待办事项链接到另一个文档时：
- 分配待办事项时，会在被引用的文档中添加一条评论
- 当待办事项完成或取消时，会添加一条评论
- 被引用文档的 `_assign` 字段中分配的用户列表会更新
- 查看被引用的文档时，用户可以看到该文档已分配给谁

## 使用分配规则

尽管不能直接为待办事项文档类型本身创建分配规则，但它们可以为其他文档类型创建待办事项：
- 基于文档条件创建规则
- 使用轮询、负载均衡或基于字段的分配来分配任务
- 基于文档字段自动设置截止日期
- 当文档条件发生变化时，关闭或重新分配待办事项
- 分配规则为整个系统的任务管理提供了强大的自动化功能