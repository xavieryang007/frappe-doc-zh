# 22.3 报告构建器 (Report Builder)

## 概述

报告构建器是Frappe框架中最简单的一种报告类型，无需编写代码即可创建。它主要用于显示单个DocType的记录及其子表的子记录。

## 主要特性

- **零代码创建**：无需编写SQL或Python代码即可创建报告
- **基于单个DocType**：显示单个文档类型的记录和子表数据
- **用户友好**：通过直观的界面操作进行配置
- **支持编辑**：可直接在报告视图中编辑记录
- **多种功能**：支持筛选、排序、分组、聚合等

## 核心功能

### 1. 保存报告

系统默认为所有DocType生成报告视图。用户可以根据不同的筛选条件、排序规则、列配置等保存多个报告版本。

**操作步骤：**
1. 进入目标DocType的报告视图
2. 调整筛选条件、排序规则或显示列
3. 点击"保存"按钮
4. 输入报告名称并确认

### 2. 更新或删除自定义报告

任何用户通过报告构建器创建的自定义报告都可以被更新或删除。

**操作方式：**
- **更新**：在报告视图中选择相应报告，点击"编辑"进行修改
- **删除**：在报告列表中选择报告，点击"删除"按钮

### 3. 打印功能

报告支持直接打印，用户可通过菜单中的"打印"选项生成纸质或PDF格式的报告。

**打印功能特点：**
- 保留当前视图的筛选和列设置
- 支持自定义打印格式
- 可设置页眉页脚等打印参数

### 4. 分组统计

支持对列进行分组（Group By），并应用聚合函数进行数据汇总。

**支持的聚合函数：**
- **计数 (Count)**：统计记录数量
- **求和 (Sum)**：计算数值字段的总和
- **平均值 (Average)**：计算数值字段的平均值

**适用场景：**
- 按客户分组统计销售订单总金额
- 按状态分组统计任务数量
- 按月份分组统计销售额

### 5. 键盘导航与编辑

由于报告构建器基于单个DocType，用户可以直接在报告视图中编辑记录。

**编辑功能：**
- 支持快速键盘导航
- 可直接修改记录数据
- 自动保存修改
- 需要相应的文档编辑权限

## 配置选项详解

### 筛选条件 (Filters)

可以设置多种筛选条件来过滤数据：

- **基础筛选**：等于、不等于、包含、不包含
- **数值范围**：大于、小于、介于
- **日期范围**：今天、本周、本月、自定义日期范围
- **多值筛选**：在列表中、不在列表中

### 排序规则 (Ordering)

支持单列或多列排序：

- **升序排序**：从小到大排列
- **降序排序**：从大到小排列
- **多列排序**：按多个字段优先级排序

### 列显示配置 (Columns)

可以自定义显示的列：

- **选择显示列**：从可用字段中选择要显示的列
- **调整列顺序**：通过拖拽调整列显示顺序
- **设置列宽**：自定义每列的宽度
- **列标题**：自定义列显示名称

### 分组设置 (Group By)

分组功能配置：

- **分组字段**：选择用于分组的字段
- **聚合函数**：选择计数、求和、平均值等聚合方式
- **分组排序**：设置分组结果的排序方式
- **显示设置**：控制分组数据的显示格式

### 打印格式 (Print Format)

打印相关配置：

- **页面设置**：纸张大小、方向、边距
- **页眉页脚**：自定义页眉页脚内容
- **数据格式**：设置日期、数字等格式
- **样式设置**：字体、颜色、布局等

## 操作指南

### 创建新报告

1. **选择DocType**：从文档类型列表中选择目标DocType
2. **设置筛选条件**：根据需求设置数据筛选条件
3. **配置显示列**：选择需要显示的字段和列顺序
4. **设置排序**：配置数据的排序规则
5. **保存报告**：点击保存并输入报告名称

### 使用分组功能

1. **启用分组**：在报告设置中打开分组功能
2. **选择分组字段**：选择用于数据分组的字段
3. **设置聚合函数**：为数值字段选择聚合方式
4. **查看结果**：查看分组后的汇总数据

### 编辑现有报告

1. **打开报告列表**：查看所有保存的报告
2. **选择目标报告**：点击要编辑的报告
3. **修改配置**：调整筛选、排序、列显示等设置
4. **保存修改**：点击更新保存修改

## 最佳实践

### 1. 命名规范

保存报告时使用清晰明了的名称：
- 包含业务场景说明（如"2024年销售分析"）
- 包含时间范围（如"本月订单统计"）
- 包含统计维度（如"按客户分组销售"）

### 2. 性能优化

- **避免过多筛选条件**：复杂的筛选条件可能影响性能
- **合理使用分组**：大数据量时谨慎使用分组功能
- **限制显示列数**：只显示必要的列提升加载速度

### 3. 权限管理

- **设置适当的访问权限**：确保用户只能访问权限范围内的数据
- **区分只读和编辑权限**：根据需要设置编辑权限
- **定期审核报告权限**：确保权限设置符合业务需求

### 4. 维护管理

- **定期清理**：删除不再使用的自定义报告
- **版本管理**：重要报告可保存多个版本用于对比
- **备份重要配置**：定期导出重要报告的配置

## 适用场景

### 适合使用报告构建器的场景

1. **简单数据查看**：快速查看单个文档类型的数据
2. **日常统计分析**：基于单个表的简单统计需求
3. **数据编辑**：需要直接编辑记录的场景
4. **临时分析**：快速生成临时数据分析报告

### 不适合使用报告构建器的场景

1. **复杂跨表查询**：需要关联多个表的复杂查询
2. **自定义计算逻辑**：需要复杂业务逻辑计算的场景
3. **大数据量处理**：需要处理大量数据的复杂分析
4. **自定义图表**：需要复杂图表展示的需求

## 进阶技巧

### 1. 组合使用筛选和分组

```
示例：统计特定时间范围内按客户分组的销售金额
1. 设置时间范围筛选条件
2. 按客户字段进行分组
3. 对销售金额字段应用求和聚合
```

### 2. 多维度分析

通过保存多个报告版本，实现多维度数据分析：
- 按时间维度保存多个版本
- 按业务维度保存不同视图
- 对比不同时间段的数据变化

### 3. 快速数据编辑

利用报告构建器的编辑功能快速修改数据：
- 批量修改记录状态
- 快速更新特定字段
- 处理日常数据维护任务

## 版本兼容性

### 版本13及以后
- 增强的分组和聚合功能
- 改进的筛选界面
- 更好的性能优化

### 版本12及以前
- 基础的分组功能
- 基本的筛选和排序
- 功能相对有限

## 常见问题

### Q: 报告构建器支持关联查询吗？
A: 不支持。报告构建器仅适用于单个DocType，如果需要关联多个表，请使用查询报告或脚本报告。

### Q: 如何导出报告数据？
A: 报告构建器支持数据导出功能，可以通过报告菜单中的"导出"选项导出为CSV或Excel格式。

### Q: 报告构建器有数据量限制吗？
A: 理论上没有硬性限制，但大数据量可能影响性能。建议使用筛选条件限制数据量。

### Q: 可以与他人共享报告吗？
A: 可以，但需要确保对方有相应的数据访问权限。

## 总结

报告构建器是Frappe框架中极为实用的工具，特别适合日常的数据查看、简单统计和快速编辑需求。通过合理使用其各项功能，可以显著提升工作效率。对于更复杂的分析需求，建议结合使用查询报告和脚本报告。