# 11.5 如何启用社交登录 (How To Enable Social Logins)

使用Facebook、Google或GitHub等第三方认证服务登录Frappe，用户无需记忆额外密码。系统会使用这些服务提供的邮箱地址与Frappe中现有用户进行匹配。如果未找到对应邮箱的用户，且网站设置中未禁用注册功能，系统将自动创建一个默认类型为"网站用户"的新用户。系统管理员后续可将该用户类型更改为"系统用户"，以便用户访问桌面端。

## 启用社交登录的前提条件

- 你需要从认证服务提供商获取**客户端ID（Client ID）**和**客户端密钥（Client Secret）**，并填入Frappe站点的"社交登录密钥"设置中。
- 路径：`桌面端 > 集成 > 认证 > 社交登录密钥`。
- 注意：如果你的站点已启用HTTPS，请将以下步骤中的`http://{{yoursite}}`替换为`https://{{yoursite}}`。

## 配置步骤

### 使用Frappe作为登录提供商

假设你有两个基于Frappe框架的站点：
- Site A（登录提供商）：`https://sitea.com`
- Site B（需启用社交登录）：`https://siteb.com`

**步骤：**

1. 在Site A（`https://sitea.com`）中进入"OAuth客户端"列表。
2. 创建新的OAuth客户端。
3. 填写应用名称（用于标识Site B）。
4. 在"重定向URI"和"默认重定向URI"中填入：`https://siteb.com/api/method/frappe.integrations.oauth2_logins.login_via_frappe`
5. 保存后，系统将生成"客户端ID"和"客户端密钥"。
6. 在Site B（`https://siteb.com`）中创建"社交登录密钥"。
7. 填入步骤5中获取的客户端ID和密钥。
8. 选择社交登录提供商为"Frappe"。
9. 在"基础URL"中填入`https://sitea.com`，保存设置。

### Facebook登录

**步骤：**

1. 访问 [Facebook开发者平台](https://developers.facebook.com)。
2. 点击"应用" > "新建应用"，填写基本信息。
3. 进入"设置" > "基本"，设置联系邮箱并保存。
4. 进入"设置" > "高级"，在"有效的OAuth重定向URI"中填入：`http://{{yoursite}}/api/method/frappe.integrations.oauth2_logins.login_via_facebook`
5. 保存高级设置。
6. 进入"状态与审核"，开启"应用公开可用"选项。
7. 在"仪表板"中点击"显示"按钮查看应用密钥，将"应用ID"和"应用密钥"分别填入Frappe的"客户端ID"和"客户端密钥"字段。

### Google登录

**步骤：**

1. 访问 [Google Cloud控制台](https://console.developers.google.com)。
2. 创建新项目并填写信息。
3. 进入"API和服务" > "凭据" > "创建凭据" > "OAuth客户端ID"。
4. 配置如下：
   - 应用类型：**Web应用**
   - 授权JavaScript来源：`http://{{yoursite}}`
   - 授权重定向URI：`http://{{yoursite}}/api/method/frappe.integrations.oauth2_logins.login_via_google`
5. 创建后，将生成的"客户端ID"和"客户端密钥"填入Frappe对应字段。

### GitHub登录

**步骤：**

1. 访问 [GitHub应用设置页面](https://github.com/settings/applications)。
2. 点击"注册新应用"。
3. 填写信息：
   - 主页URL：`http://{{yoursite}}`
   - 授权回调URL：`http://{{yoursite}}/api/method/frappe.integrations.oauth2_logins.login_via_github`
4. 注册后，复制生成的"客户端ID"和"客户端密钥"到Frappe的"社交登录密钥"中。

### Office 365登录

**步骤：**

1. 访问 [Azure门户](https://portal.azure.com)。
2. 进入"Azure Active Directory" > "应用注册"，创建新注册。
3. 填写信息：
   - 应用名称
   - 支持的账户类型：**任何组织目录中的账户（多租户）**
   - 重定向URI：`http://{{yoursite}}/api/method/frappe.integrations.oauth2_logins.login_via_office365`
4. 注册后，在"概述"中复制"应用程序（客户端）ID"到Frappe的"客户端ID"。
5. 进入"证书和密码"，创建新客户端密钥，将密钥填入Frappe的"客户端密钥"。
6. 选择社交登录提供商为"Office 365"。
7. 启用社交登录并保存。
8. 在"令牌配置"中添加可选声明：
   - 令牌类型：ID
   - 声明：email

## 注意事项

- 启用社交登录后，用户将通过第三方服务认证，无需输入Frappe账号密码。
- 新用户默认创建为"网站用户"，需管理员手动提升为"系统用户"方可访问桌面端。
- 确保重定向URI与Frappe站点地址完全一致（包括HTTP/HTTPS）。