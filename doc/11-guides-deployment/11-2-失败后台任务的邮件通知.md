# 11.2 失败后台任务的邮件通知 (Email Notifications For Failed Background Jobs)

Frappe框架处理后台任务失败的机制如下：

1. **任务失败时**：如果任务执行失败（抛出异常），相关信息会被记录在`Scheduler Log`和`logs/worker.error.log`日志文件中。
2. **锁定文件**：系统会创建一个锁文件。只要该锁文件存在，相同的任务就不会再次运行。
3. **锁定超时错误**：如果锁文件的存在时间超过10分钟，系统会抛出`LockTimeoutError`。

## 配置邮件通知

您可以配置邮件通知，以便在计划任务出错时接收提醒。配置方法如下：

1. 创建或编辑站点配置文件：`sites/common_site_config.json`
2. 在该文件中添加以下配置内容：

```json
{
  "celery_error_emails": {
    "ADMINS": [
      [
        "人员1",
        "person1@example.com"
      ],
      [
        "人员2",
        "person2@example.com"
      ]
    ],
    "SERVER_EMAIL": "exceptions@example.com"
  }
}
```

## 配置项说明

- `ADMINS`：一个列表，包含需要接收错误邮件通知的管理员信息。每个管理员信息是一个包含两个元素的列表，分别是姓名和邮箱地址。
- `SERVER_EMAIL`：用于发送这些错误通知邮件的发件人邮箱地址。

## 重要提示（局限性）

该邮件通知功能目前有一个局限性：它**会使用本地邮件服务器（通常运行在25端口）来发送邮件**。请确保您的部署环境中有可用的本地邮件发送服务。