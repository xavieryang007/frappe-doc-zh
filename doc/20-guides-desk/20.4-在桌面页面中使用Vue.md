# 20.4 在桌面页面中使用Vue

## 概述

使用Vue为基于桌面的应用添加页面，可以兼顾两方面的优势：
1. 利用Vue的响应式和组件化特性
2. 使用Frappe的JS API

无需手动配置Vue应用，即可实现上述功能。

## 完整实施步骤

### 步骤一：创建页面

1. 进入 **Page DocType**（路径：`/app/page`）
2. 创建一个新的页面条目
3. 选择目标模块，系统将在该模块下自动生成页面文件

### 步骤二：检查生成的文件

在应用模块文件夹中，会生成以下文件结构：

```
└── app
    └── app
        └── module
            └── page
                └── page_name
                    ├── __init__.py
                    ├── page_name.json
                    └── page_name.js
```

其中，`page_name.js` 文件包含以下代码，用于创建页面：

```javascript
frappe.pages['page-name'].on_page_load = function (wrapper) {
  var page = frappe.ui.make_app_page({
    parent: wrapper,
    title: 'None',
    single_column: true,
  });
};
```

访问路径 `/app/page-name` 将显示一个标题为"None"的空页面。

### 步骤三：创建Vue文件

Vue的 `.vue` 源文件需要被转译和打包，Frappe框架已内置支持。

在应用的 `public/js` 文件夹下创建以下文件：

```
└── app
    └── app
        └── public
            └── page_name
                ├── PageName.vue
                └── page_name.bundle.js
```

#### 1. 创建Vue组件文件（PageName.vue）

```vue
<script setup>
import { ref } from 'vue';

const message = ref('Hello, World');
</script>

<template>
  <h1>{{ message }}</h1>
</template>
```

#### 2. 创建打包入口文件（page_name.bundle.js）

```javascript
import { createApp } from 'vue';
import PageName from './PageName.vue';

function setup_vue(wrapper) {
  const app = createApp(PageName);
  app.mount(wrapper.get(0));
  return app;
}

frappe.ui.setup_vue = setup_vue;
export default setup_vue;
```

### 步骤四：引入打包文件

在生成的 `page_name.js` 文件中添加以下代码，以加载Vue应用：

```javascript
frappe.pages['page-name'].on_page_load = function (wrapper) {
  const page = frappe.ui.make_app_page({
    parent: wrapper,
    title: 'Page Name',
    single_column: true,
  });

  // 开发模式下支持热重载
  if (frappe.boot.developer_mode) {
    frappe.hot_update ??= frappe.hot_update;
    frappe.hot_update.push(() => load_vue(wrapper));
  }
};

frappe.pages['page-name'].on_page_show = (wrapper) => load_vue(wrapper);

async function load_vue(wrapper) {
  const $parent = $(wrapper).find('.layout-main-section');
  $parent.empty();

  // 引入打包文件并挂载Vue应用
  await frappe.require('page_name.bundle.js');
  frappe.page_name_app = frappe.ui.setup_vue($parent);
}
```

### 步骤五：构建或运行开发服务器

#### 构建命令：
```bash
bench build
```

> 注意：此命令将构建所有应用的前端代码。

#### 开发模式（监听变化并自动重建）：
进入 `frappe` 应用目录（例如 `bench/apps/frappe`），执行：

```bash
npm run build -- --apps 你的应用名 --watch
```

这将监听文件变化并自动重建，触发浏览器热重载。

## 预期结果

完成上述步骤后，访问页面路径（如 `/app/page-name`），将显示Vue组件中定义的内容（例如："Hello, World"）。

## 技术要点

### 框架集成
- Vue 3 Composition API 支持
- Frappe 框架无缝集成
- 热重载开发体验

### 文件组织
- 清晰的目录结构
- 模块化的代码组织
- 易于维护和扩展

---

*。*