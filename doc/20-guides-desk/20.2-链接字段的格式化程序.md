# 20.2 链接字段的格式化程序

## 概述

链接字段格式化程序用于在链接字段中同时显示ID和名称，特别适用于实体（如员工）同时维护代码和名称的情况。

## 应用场景

当需要显示更丰富的链接信息时，例如：
- 员工实体：显示员工代码和员工姓名
- 客户实体：显示客户编号和客户名称
- 产品实体：显示产品编码和产品名称

## 实现方法

### 示例代码

```javascript
frappe.form.link_formatters['Employee'] = function(value, doc) {
    if(doc.employee_name && doc.employee_name !== value) {
        return value + ': ' + doc.employee_name;
    } else {
        return value;
    }
}
```

## 使用说明

### 数据要求
- 主键（名称）必须存在于文档中
- 描述性名称（如 `employee_name`）必须存在于文档中
- 描述性名字段可以设置为隐藏字段

### 加载时机
此格式化程序需要在文档加载之前加载，并且可以在所有表单中重复使用。

### 配置选项
可以将此格式化程序添加到 `build.json` 文件中进行全局配置。

## 实现原理

1. **参数说明**
   - `value`: 实体的主键值（如员工代码）
   - `doc`: 完整的文档对象

2. **逻辑判断**
   - 检查描述性名称是否存在且与主键不同
   - 如果满足条件，返回格式为"代码: 名称"的字符串
   - 否则仅返回主键值

## 注意事项

- 示例中假设员工实体的主键为 `value`（即员工代码）
- 描述性名称为 `employee_name` 字段
- 格式化程序适用于所有需要类似显示格式的场景

## 扩展应用

此方法可以应用于任何需要自定义链接显示格式的场景，只需修改实体名称和相应的字段名即可。

---

*。*