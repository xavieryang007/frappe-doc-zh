# 应用页面 (Apps Page)

应用页面是Frappe框架中用于展示和管理应用程序的功能模块，提供统一的应用程序入口和展示界面。

## 功能特性

- **应用展示**: 统一展示所有可用的应用程序
- **分类管理**: 按功能分类组织应用程序
- **权限控制**: 基于用户角色的应用访问控制
- **安装管理**: 支持应用的安装和卸载
- **版本控制**: 管理应用的不同版本

## 应用页面结构

### 主应用页面

```python
# 获取所有可用的应用程序
apps = frappe.get_all("Installed Applications",
    fields=["app_name", "app_title", "app_description", "app_version", "app_icon"],
    filters={"enabled": 1},
    order_by="app_title"
)
```

### 应用分类

```python
# 按分类组织应用
app_categories = {
    "erp": "ERP系统",
    "crm": "客户关系管理",
    "hr": "人力资源",
    "accounting": "财务会计",
    "custom": "自定义应用"
}

# 获取每个分类的应用
for category, category_name in app_categories.items():
    category_apps = frappe.get_all("Installed Applications",
        filters={
            "enabled": 1,
            "app_category": category
        },
        fields=["app_name", "app_title", "app_description"]
    )
```

## 应用管理

### 应用安装

```python
# 安装新应用
from frappe.installer import install_app

def install_new_app(app_name):
    try:
        install_app(app_name)
        frappe.msgprint(f"应用 {app_name} 安装成功")
    except Exception as e:
        frappe.throw(f"应用安装失败: {str(e)}")
```

### 应用卸载

```python
# 卸载应用
from frappe.installer import remove_app

def uninstall_app(app_name):
    try:
        remove_app(app_name, yes=True)
        frappe.msgprint(f"应用 {app_name} 卸载成功")
    except Exception as e:
        frappe.throw(f"应用卸载失败: {str(e)}")
```

## 应用页面设计

### 响应式网格布局

```html
<!-- 应用卡片网格布局 -->
<div class="apps-grid">
    {% for app in apps %}
    <div class="app-card">
        <div class="app-icon">
            <img src="{{ app.app_icon }}" alt="{{ app.app_title }}">
        </div>
        <div class="app-info">
            <h3 class="app-title">{{ app.app_title }}</h3>
            <p class="app-description">{{ app.app_description }}</p>
            <div class="app-meta">
                <span class="app-version">v{{ app.app_version }}</span>
                <span class="app-category">{{ app.app_category }}</span>
            </div>
        </div>
        <div class="app-actions">
            <button class="btn btn-primary" onclick="openApp('{{ app.app_name }}')">
                打开应用
            </button>
        </div>
    </div>
    {% endfor %}
</div>
```

### 样式设计

```css
.apps-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    padding: 20px;
}

.app-card {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 20px;
    transition: transform 0.2s;
}

.app-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.15);
}

.app-icon img {
    width: 64px;
    height: 64px;
    border-radius: 8px;
}

.app-title {
    font-size: 18px;
    font-weight: 600;
    margin: 10px 0 5px 0;
}

.app-description {
    color: #666;
    font-size: 14px;
    line-height: 1.4;
}

.app-meta {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
    font-size: 12px;
    color: #999;
}
```

## 应用发现功能

### 应用搜索

```javascript
// 应用搜索功能
function searchApps(query) {
    const apps = document.querySelectorAll('.app-card');
    
    apps.forEach(app => {
        const title = app.querySelector('.app-title').textContent.toLowerCase();
        const description = app.querySelector('.app-description').textContent.toLowerCase();
        
        if (title.includes(query) || description.includes(query)) {
            app.style.display = 'block';
        } else {
            app.style.display = 'none';
        }
    });
}
```

### 应用过滤

```javascript
// 按分类过滤应用
function filterAppsByCategory(category) {
    const apps = document.querySelectorAll('.app-card');
    
    apps.forEach(app => {
        const appCategory = app.querySelector('.app-category').textContent;
        
        if (category === 'all' || appCategory === category) {
            app.style.display = 'block';
        } else {
            app.style.display = 'none';
        }
    });
}
```

## 应用权限管理

### 角色权限检查

```python
# 检查用户是否有权限访问应用
def check_app_permission(app_name, user=None):
    if not user:
        user = frappe.session.user
    
    # 获取应用权限配置
    app_permissions = frappe.get_all("App Permission",
        filters={"app_name": app_name},
        fields=["role"]
    )
    
    # 检查用户角色
    user_roles = frappe.get_roles(user)
    
    for permission in app_permissions:
        if permission.role in user_roles:
            return True
    
    return False
```

### 动态应用列表

```python
# 根据用户权限获取可访问的应用列表
def get_accessible_apps(user=None):
    if not user:
        user = frappe.session.user
    
    all_apps = frappe.get_all("Installed Applications",
        filters={"enabled": 1},
        fields=["app_name", "app_title", "app_description"]
    )
    
    accessible_apps = []
    
    for app in all_apps:
        if check_app_permission(app.app_name, user):
            accessible_apps.append(app)
    
    return accessible_apps
```

## 应用市场集成

### 应用发现

```python
# 从应用市场获取可用应用
def get_marketplace_apps():
    try:
        # 调用应用市场API
        response = requests.get("https://marketplace.frappe.io/api/apps")
        
        if response.status_code == 200:
            apps = response.json()
            return apps
        else:
            return []
    except Exception:
        return []
```

### 一键安装

```python
# 从应用市场一键安装应用
def install_from_marketplace(app_name):
    try:
        # 下载应用包
        download_url = f"https://marketplace.frappe.io/api/apps/{app_name}/download"
        
        # 安装应用
        install_app(app_name)
        
        frappe.msgprint(f"应用 {app_name} 安装成功")
        
    except Exception as e:
        frappe.throw(f"应用安装失败: {str(e)}")
```

## 性能优化

### 应用列表缓存

```python
# 缓存应用列表提高性能
@frappe.whitelist()
def get_apps_list():
    cache_key = f"apps_list_{frappe.session.user}"
    
    apps = frappe.cache().get_value(cache_key)
    
    if not apps:
        apps = get_accessible_apps()
        
        # 缓存30分钟
        frappe.cache().set_value(cache_key, apps, expires_in_sec=1800)
    
    return apps
```

### 懒加载应用图标

```javascript
// 懒加载应用图标
function lazyLoadAppIcons() {
    const appIcons = document.querySelectorAll('.app-icon img');
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                img.src = img.dataset.src;
                observer.unobserve(img);
            }
        });
    });
    
    appIcons.forEach(img => {
        img.dataset.src = img.src;
        img.src = '/assets/frappe/images/placeholder-app-icon.png';
        observer.observe(img);
    });
}
```

## 最佳实践

1. **应用分类**: 合理分类应用，提高用户体验
2. **权限管理**: 严格控制应用访问权限
3. **性能优化**: 缓存应用列表，提高加载速度
4. **响应式设计**: 确保在不同设备上的良好显示
5. **更新维护**: 定期更新应用版本和依赖

应用页面功能为Frappe框架提供了统一的应用程序管理界面，是用户访问和使用各种应用的主要入口。