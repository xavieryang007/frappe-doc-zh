# 14.1 使用数据迁移工具 (Using the Data Migration Tool)

## 数据迁移工具使用指南

### 1. **数据迁移计划（Data Migration Plan）**
- **作用**：封装一组映射规则，用于定义同步任务。
- **创建步骤**：
  1. 设置计划名称（如 "Atlas Sync"）。
  2. 在子表中添加映射（Mapping）。

### 2. **数据迁移映射（Data Migration Mapping）**
- **作用**：定义本地与远程字段的对应关系。
- **关键配置**：
  - **远程对象名**（如 "Atlas Item"）。
  - **远程主键**（如 "id"）。
  - **本地 DocType**（如 "Item"）。
  - **映射类型**：Push（推送到远程）、Pull（从远程拉取）、Sync（双向同步）。
  - **分页长度**：每批次同步的数据量。

#### 字段映射规则：
- 支持直接字段名对应。
- 对于单向映射（Push/Pull），源字段可以是：
  - 字面量（如 `"GadgetTech"`）。
  - 表达式（如 `"eval:frappe.db.get_value('Company', 'Gadget Tech', 'default_currency')"`）。

### 3. **预处理与后处理（Pre/Post Process）**
- 在映射执行前后可插入自定义逻辑：
  - `pre_process`：在处理源文档前执行。
  - `post_process`：在映射完成后执行，可访问源和目标文档。

### 4. **数据迁移连接器（Data Migration Connector）**
- **作用**：管理与远程数据源的连接。
- **创建步骤**：
  1. 选择连接器类型（如 "Atlas"）。
  2. 配置主机、用户名、密码等认证信息。
  3. 编写连接器代码（需实现 `insert`、`update`、`delete` 方法）。

### 5. **数据迁移执行（Data Migration Run）**
- **作用**：根据计划和连接器执行同步任务。
- **特点**：
  - 自动分页、队列处理。
  - 增量更新：仅同步上次运行后变更或失败的记录。
  - 完成后需新建运行记录才能再次执行。

## 注意事项
- 数据迁移工具目前处于 **Beta 阶段**，使用中遇到问题可反馈至 Frappe 官方。
- 确保远程连接器代码正确实现，参考现有连接器（如 `frappe_connection.py`）。

**原始链接**: https://docs.frappe.io/framework/user/en/guides/data/using-data-migration-tool