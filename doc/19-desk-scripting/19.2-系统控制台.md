# 19.2 系统控制台

系统控制台是Frappe框架中的一个工具，主要用于**调试**和**运行Python命令**。它基于**Script API**，允许用户在受控环境中执行Python代码，以便检查数据、测试功能或进行故障排除。

> **注意**：只有拥有**"系统管理员"（System Manager）**角色的用户才能访问系统控制台。

## 访问方式

- 在Frappe Desk的**搜索栏**中直接搜索"System Console"即可打开系统控制台界面

## 使用方法

系统控制台允许你直接运行Python代码，并利用**Script API**中提供的方法。以下是一些关键点：

### 可用API

- 系统控制台暴露了**Script API**中的所有方法，你可以直接调用这些方法来与数据库、文档、权限系统等进行交互
- 常见的API包括：
  - 数据库操作（查询、更新、删除）
  - 文档操作（创建、读取、更新、删除文档）
  - 用户和权限管理
  - 后台作业控制
  - 日志记录

### 日志记录响应

- 为了查看命令执行的结果，你可以使用**`log`**方法将响应输出到控制台
- 示例：

```python
# 在系统控制台中运行以下代码
log("Hello, System Console!")  # 输出文本信息
doc = frappe.get_doc("User", "Administrator")  # 获取用户文档
log(doc.email)  # 输出Administrator的邮箱地址
```

## 示例代码

以下是一些在系统控制台中常用的代码示例：

### 查询并输出文档信息

```python
# 获取特定文档（例如用户"Administrator"）并输出其邮箱
user = frappe.get_doc("User", "Administrator")
log(f"用户邮箱: {user.email}")
```

### 执行数据库查询

```python
# 使用frappe.db.sql执行SQL查询
results = frappe.db.sql("SELECT name, email FROM `tabUser` WHERE enabled=1", as_dict=True)
for user in results:
    log(f"用户: {user['name']}, 邮箱: {user['email']}")
```

### 创建新文档

```python
# 创建一个新的ToDo文档
todo = frappe.get_doc({
    "doctype": "ToDo",
    "description": "这是一个通过系统控制台创建的任务",
    "status": "Open"
})
todo.insert()
log("ToDo文档创建成功！")
```

### 修改现有文档

```python
# 修改用户文档的某个字段
user = frappe.get_doc("User", "Administrator")
user.first_name = "管理员"
user.save()
log("用户文档已更新")
```

## 配置选项

系统控制台本身不需要额外的配置，但以下相关设置可能影响其使用：

- **用户角色**：确保当前用户具有**"System Manager"**角色，否则无法访问系统控制台
- **Script API权限**：系统控制台执行的代码受Script API的权限控制，确保API方法在当前站点和环境下可用
- **调试模式**：在开发环境中，可以启用**开发者模式**以获得更详细的错误信息和日志输出

## 注意事项

- **谨慎操作**：系统控制台中执行的代码具有高度权限，可以直接修改数据库和系统设置，请确保仅运行可信代码
- **日志输出**：使用`log()`方法输出信息，方便调试和查看结果
- **错误处理**：如果代码出现错误，系统控制台会显示详细的错误信息，帮助你快速定位问题

## 最佳实践

1. **测试代码**：在系统控制台中运行代码前，最好先在安全环境中测试
2. **备份数据**：在进行可能影响数据的操作前，建议先备份相关数据
3. **逐步执行**：复杂操作建议分步骤执行，便于调试和问题排查
4. **清理临时数据**：测试完成后，及时清理创建的任何临时数据或文档

## 总结

系统控制台是Frappe框架中一个强大的调试工具，适合系统管理员和开发者进行快速数据查询、文档操作和功能测试。通过结合Script API，你可以高效地完成各种系统级任务。

---

**原始链接**：https://docs.frappe.io/framework/user/en/desk/scripting/system-console