# 34.4 翻译 (Translations)

## 概述
Frappe内置了一套翻译系统，用于从代码中提取可翻译字符串，并将其转换为不同语言的CSV文件。

## 翻译流程

### 1. 提取可翻译字符串
自动从DocType的JSON文件等解析字段标签和描述，或通过代码中的 `_()` 或 `__()` 方法显式标记。

### 2. 翻译提取的字符串
将字符串按语言存入CSV文件，由社区用户通过翻译门户提交翻译，经审核后合并到核心代码中。

### 3. 在应用中翻译字符串
通过键值对（原始字符串与翻译后的字符串）实现动态替换。

## 编写可翻译字符串的规范

### 1. 必须使用字面量字符串
不能使用变量或表达式。

**正确示例（Python）**：
```python
_('Document submitted successfully')
```

**错误示例**：先赋值字符串再翻译。

### 2. 变量需使用位置格式化符 `{0}`
不支持其他格式化方式。

**正确示例**：
```python
_('Welcome {0}').format(username)
```

### 3. 避免拆分或多行字符串
应保持字符串完整。

### 4. 处理复数形式时需分开写
每种语言的复数规则不同。

### 5. 字符串首尾不得有空格
需空格应在翻译函数外添加。

### 6. 可通过 `context` 参数提供上下文
避免一词多义问题。

**JavaScript示例**：
```javascript
__('Change', null, 'Coins')
```

**Python示例**：
```python
_('Change', context='Switch')
```

## 添加新语言的步骤

### 1. 导出未翻译字符串
```bash
bench --site sitename get-untranslated [语言代码] [文件路径]
```

### 2. 翻译文件
使用谷歌翻译等工具翻译导出的CSV文件。

### 3. 导入翻译
```bash
bench update-translations [语言代码] [源文件路径] [翻译后文件路径]
```

### 4. 更新语言列表
在 `frappe/geo/languages.json` 中添加新语言。

### 5. 提交更改
将生成的CSV文件提交到各应用的代码库中。

## 注意事项

- 翻译文件以CSV格式存储，定期通过社区贡献更新
- 代码中的字符串必须严格遵循规范，否则无法被解析

## 总结
Frappe的翻译系统通过自动化提取、社区协作和动态替换实现多语言支持。开发者需遵循字符串编写规范，并通过命令行工具管理翻译流程。如需添加新语言，需按步骤导出、翻译并导入字符串，最后更新语言配置。