# 18.4 使用Frappe API进行UI测试

您可以选择编写集成测试，或者直接使用 [QUnit](http://api.qunitjs.com/) 编写 JavaScript 测试。

QUnit 帮助您使用 QUnit 框架和原生 frappe API 编写 UI 测试。正如您可能猜到的那样，这是一种更快的编写测试方式。

## 测试运行器

要编写基于 QUnit 的测试，请将测试添加到应用程序的 `tests/ui` 文件夹中。您的测试文件必须以 `test_` 开头，并以 `.js` 扩展名结尾。

要运行文件，您可以使用**测试运行器**。**测试运行器**提供了一个用户界面来加载所有 QUnit 测试并在浏览器中运行它们。

在 CI 中，所有 QUnit 测试都通过 `frappe/tests/test_test_runner.py` 由**测试运行器**运行。

## 运行测试

要运行基于测试运行器的测试，请使用 `run-ui-tests` bench 命令，传递您要运行的文件名。

```bash
bench run-ui-tests --test frappe/tests/ui/test_list.js
```

这将把文件名传递给 `test_test_runner.py`，它将在浏览器中加载所需的 JS 并执行测试。

## 调试测试

要调试测试，您可以从 UI 中的**测试运行器**打开它，然后手动运行以查看它确切在哪里失败。

## 测试序列

在 Frappe UI 中，测试以固定顺序运行以确保依赖关系。

测试运行顺序将在 `tests/ui/tests.txt` 文件中。

## 运行所有 UI 测试

要一起为您的应用程序运行所有 UI 测试，请运行：

```bash
bench run-ui-tests --app [app_name]
```

这将逐一运行您的 `tests/ui` 文件夹中的所有文件。

## QUnit 测试示例

以下是 To Do 测试的 QUnit 示例：

```javascript
QUnit.test("Test quick entry", function(assert) {
    assert.expect(2);
    let done = assert.async();
    let random_text = frappe.utils.get_random(10);

    frappe.run_serially([
        () => frappe.set_route('List', 'ToDo'),
        () => frappe.new_doc('ToDo'),
        () => frappe.quick_entry.dialog.set_value('description', random_text),
        () => frappe.quick_entry.insert(),
        (doc) => {
            assert.ok(doc && !doc.__islocal);
            return frappe.set_route('Form', 'ToDo', doc.name);
        },
        () => assert.ok(cur_frm.doc.description.includes(random_text)),

        // 删除创建的 ToDo
        () => frappe.tests.click_page_head_item('Menu'),
        () => frappe.tests.click_dropdown_item('Delete'),
        () => frappe.tests.click_page_head_item('Yes'),

        () => done()
    ]);
});
```

## 使用 Promise 编写测试友好代码

Promise 是编写测试友好代码的好方法。如果您的方法调用异步调用（ajax），那么您应该返回一个 `Promise` 对象。在编写测试时，如果遇到不返回 `Promise` 对象的函数，您应该更新代码以返回 `Promise` 对象。