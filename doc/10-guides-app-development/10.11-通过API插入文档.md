# 10.11 通过API插入文档

## 认证方式

在Frappe框架中，您需要通过REST API插入新的文档。首先需要获取认证令牌：

- **Token认证**：使用`api_key`和`api_secret`生成访问令牌。
- **OAuth 2.0**：也可以使用OAuth 2.0流程获取访问令牌。

## API端点

插入文档的API端点为：
```
POST /api/resource/{DocType}
```

- `{DocType}`：要插入的文档类型（如"User"、"Task"等）。

## 请求头（Headers）

在请求头中设置：
- `Authorization`：Bearer {access_token} 或 Token {api_key}:{api_secret}
- `Content-Type`：`application/json`

## 请求体（Body）

请求体为JSON格式，包含文档的字段和值。例如：
```json
{
  "field1": "value1",
  "field2": "value2",
  ...
}
```

## 示例代码

### 使用cURL调用

```bash
curl -X POST https://your-erp-site.com/api/resource/DocType \
  -H "Authorization: Token api_key:api_secret" \
  -H "Content-Type: application/json" \
  -d '{
        "field1": "value1",
        "field2": "value2"
      }'
```

### 使用Python（requests库）调用

```python
import requests

url = "https://your-erp-site.com/api/resource/DocType"
headers = {
    "Authorization": "Token api_key:api_secret",
    "Content-Type": "application/json"
}
data = {
    "field1": "value1",
    "field2": "value2"
}

response = requests.post(url, json=data, headers=headers)
print(response.json())
```

### 使用JavaScript（fetch）调用

```javascript
fetch('https://your-erp-site.com/api/resource/DocType', {
  method: 'POST',
  headers: {
    'Authorization': 'Token api_key:api_secret',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    field1: 'value1',
    field2: 'value2'
  })
})
.then(response => response.json())
.then(data => console.log(data));
```

## 响应

成功插入后，API会返回新创建的文档数据，包括`name`（唯一标识符）等字段。例如：
```json
{
  "data": {
    "name": "new-doc-001",
    "owner": "user@example.com",
    ...
  }
}
```

## 错误处理

- 如果认证失败，返回HTTP 401。
- 如果字段验证失败或数据无效，返回HTTP 400及错误详情。

## 注意事项

- 确保您的API密钥有足够的权限创建该DocType的文档。
- 在生产环境中使用HTTPS。
- 您可以通过Frappe Desk中的"设置" > "用户" > "API密钥"生成API密钥。

如果您需要更具体的示例（如插入特定DocType，如"用户"或"任务"），请提供DocType名称，我可以为您定制示例。

---

原始链接: https://docs.frappe.io/framework/user/en/guides/app-development/insert-a-document-via-api