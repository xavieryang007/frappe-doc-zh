# 10.20 将自定义导出到您的应用

本文档详细介绍了在Frappe框架中如何将自定义设置导出到应用，包括导出流程和自定义管理的关键信息。

## 概述

在Frappe框架中，用户可以通过**Customize Form**对DocType进行扩展（如添加自定义字段、属性设置器等）。为了将这些自定义设置保存到应用中，以便在更新或迁移时同步，Frappe提供了**Export Customizations**功能。

## 导出流程

### 1. 进入Customize Form
在Frappe Desk中，打开需要自定义的DocType，点击**Customize Form**按钮。

### 2. 点击Export Customizations
在Customize Form界面中，找到并点击**Export Customizations**按钮。

### 3. 选择模块和同步选项
- **模块（Module）**：选择要将自定义设置导出到的应用模块。
- **同步选项**：可选择是否在每次更新后自动同步这些自定义设置。

### 4. 导出文件位置
自定义设置将导出到应用模块目录下的`custom`文件夹中，文件以DocType的名称命名。

**示例路径**：`[app]/[module]/custom/[doctype_name].json`

### 5. 同步自定义设置
当执行`bench update`或`bench migrate`命令时，这些导出的自定义设置将自动同步到站点。

## 自定义管理

### 1. 文件结构
导出的自定义设置以JSON格式保存，包含属性设置器（Property Setters）和自定义权限等信息。

**示例JSON结构**：
```json
{
    "doctype": "User",
    "property_setters": [
        {
            "fieldname": "first_name",
            "property": "reqd",
            "value": "1",
            "property_type": "Check"
        }
    ],
    "custom_fields": [
        {
            "fieldname": "custom_field_1",
            "fieldtype": "Data",
            "label": "Custom Field 1",
            "insert_after": "last_name"
        }
    ]
}
```

### 2. 覆盖行为
每次同步时，站点上的所有属性设置器和自定义权限将被代码中的设置**完全替换**。如果不需要此行为，应避免使用此功能。

### 3. 版本控制
建议将导出的`custom`文件夹纳入版本控制（如Git），以便团队协作和部署。

## 详细操作步骤

### 1. 启用开发者模式
在导出自定义之前，确保已启用开发者模式：
```bash
bench --site [site-name] set-config developer_mode 1
```

### 2. 执行自定义导出
1. 导航到目标DocType
2. 点击"Customize"按钮
3. 在自定义表单界面中点击"Export Customizations"
4. 选择目标模块并确认导出

### 3. 手动导出（命令行）
也可以通过命令行手动导出自定义：
```bash
bench --site [site-name] export-customizations [doctype] [module]
```

## 高级功能

### 1. 批量导出
可以一次性导出多个DocType的自定义：
```bash
# 导出所有自定义到指定模块
bench --site [site-name] export-customizations --all [module]
```

### 2. 排除特定自定义
在某些情况下，可能需要排除特定的自定义设置：
```bash
# 排除特定字段的自定义
bench --site [site-name] export-customizations [doctype] [module] --exclude-fields [field1,field2]
```

### 3. 自定义同步策略
可以通过修改应用的`hooks.py`文件来自定义同步策略：
```python
# hooks.py
after_migrate = [
    "my_app.custom.sync_customizations"
]
```

## 注意事项

### 1. 警告信息
使用此功能时，请确保导出的自定义设置是最终版本，因为同步操作会覆盖现有的站点设置。

### 2. 适用场景
适用于需要将自定义设置持久化到代码中，并在多环境（开发、生产）间保持一致的情况。

### 3. 不适用场景
- 临时性的自定义设置
- 仅用于特定环境的设置
- 频繁变化的配置

## 故障排除

### 1. 导出失败
- 检查开发者模式是否已启用
- 验证目标模块是否存在
- 确认有足够的文件系统权限

### 2. 同步失败
- 检查JSON文件格式是否正确
- 验证自定义字段定义是否有效
- 查看错误日志获取详细信息

### 3. 权限问题
- 确保执行命令的用户有相应权限
- 检查文件和目录权限设置

## 最佳实践

1. **定期备份**：在导出自定义之前备份现有设置
2. **测试同步**：在生产环境同步前在测试环境验证
3. **文档记录**：记录重要的自定义设置变更
4. **团队协作**：通过版本控制系统管理自定义设置

## 相关命令

```bash
# 查看已导出的自定义
bench --site [site-name] list-customizations

# 导入自定义设置
bench --site [site-name] import-customizations [module]

# 清除自定义设置
bench --site [site-name] clear-customizations [doctype]
```

---

原始链接: https://docs.frappe.io/framework/user/en/guides/app-development/exporting-customizations