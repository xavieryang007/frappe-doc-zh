# 10.16 在桌面上添加模块图标

本文档详细介绍了如何在Frappe框架中为应用模块添加桌面图标，包括图标配置、位置设置和自定义方法。

## 概述

在Frappe框架中，应用模块的图标显示在桌面上（即工作台Workspace），这通过在应用配置文件中定义模块数据来实现。主要涉及两个文件：
1. **`config/desktop.py`**：定义模块本身在桌面上的图标、标签和分类。
2. **`config/<module_name>.py`**（可选）：定义点击模块图标后，其主页面上显示的项目（如文档类型、报表等）以及模块下拉菜单中的快捷操作。

## 1. 图标配置 (`config/desktop.py`)

此文件中的 `get_data` 函数返回一个列表，列表中的字典定义了模块的显示属性。

**配置参数说明**：

| 参数名 | 描述 | 示例值 | 备注 |
| :--- | :--- | :--- | :--- |
| `module_name` | 模块的内部名称（唯一标识）。 | `"Library Management"` | 通常与模块目录名一致。 |
| `category` | 模块在桌面上的分类。 | `"Modules"` | 常见分类有 "Modules", "Places", "Administration" 等。 |
| `label` | 模块显示在桌面上的名称。 | `_("Library Management")` | 使用 `_()` 函数以支持国际化。 |
| `color` | 模块图标的背景色。 | `"#589494"` | 十六进制颜色代码。 |
| `icon` | 模块的图标类。 | `"octicon octicon-book"` | 通常使用Octicons或Font Awesome图标类。 |
| `type` | 条目类型，对于模块固定为 `"module"`。 | `"module"` | - |
| `description` | 模块的描述信息（悬停时显示）。 | `"Library management"` | - |

**示例代码 (`config/desktop.py`)**：

```python
from frappe import _

def get_data():
    return [
        {
            "module_name": "Library Management",
            "category": "Modules",
            "label": _("Library Management"),
            "color": "#589494",
            "icon": "octicon octicon-book",
            "type": "module",
            "description": _("Manage books, members, and transactions.")
        }
    ]
```

## 2. 位置设置与内容定义 (`config/<module_name>.py`)

此文件用于定义模块的"内容"。当用户点击桌面上的模块图标后，会跳转到该模块的主页面。此文件定义了该页面上显示的项目列表以及模块图标下拉菜单中的快捷操作。

**配置参数说明 (文件顶层)**：

| 参数名 | 描述 | 示例值 |
| :--- | :--- | :--- |
| `label` | 模块页面的标题。 | `_("Library Management")` |
| `icon` | 模块页面的图标（通常与桌面图标一致）。 | `"octicon octicon-book"` |
| `items` | 一个列表，包含该模块下所有的可访问项目。 | `[ ... ]` |

**`items` 列表中的项目类型**：
每个项目也是一个字典，最常见的类型是文档类型 (`"doctype"`)。

| 参数名 | 描述 | 示例值 | 备注 |
| :--- | :--- | :--- | :--- |
| `type` | 项目的类型。 | `"doctype"` | 也可以是 "page", "report" 等。 |
| `name` | 项目的名称（如DocType的名称）。 | `"Article"` | 必须与系统中定义的对象名一致。 |
| `label` | 项目显示的名称。 | `_("Article")` | 使用 `_()` 函数。 |
| `description` | 项目的描述。 | `_("Manage Books")` | - |
| `onboard` | 是否在模块的"快速入门"或下拉菜单中突出显示。 | `1` (是) 或 `0` (否) | 值为 `1` 的项目通常会显示在模块图标的下拉菜单中。 |

**示例代码 (`config/library_management.py`)**：

```python
from frappe import _

def get_data():
    return [
        {
            "label": _("Library Management"),
            "icon": "octicon octicon-book",
            "items": [
                {
                    "type": "doctype",
                    "name": "Article",
                    "label": _("Article"),
                    "description": _("Manage Books"),
                    "onboard": 1,  # 会在模块下拉菜单中显示
                },
                {
                    "type": "doctype",
                    "name": "Library Member",
                    "label": _("Library Member"),
                    "description": _("Manage Members"),
                    "onboard": 0,  # 不会在下拉菜单中显示，但会在模块主页面显示
                },
                {
                    "type": "doctype",
                    "name": "Library Transaction",
                    "label": _("Transaction"),
                    "description": _("Record book issues and returns.")
                }
            ]
        }
    ]
```

## 3. 自定义方法与高级配置

### 3.1 权限控制
模块及其内容项的可见性自动遵循Frappe的权限规则（Role Permissions）。用户只能看到其拥有权限的模块和文档类型。

### 3.2 使用自定义图标
除了 `octicon`，你也可以使用 `fa` (Font Awesome) 图标。
```python
"icon": "fa fa-book"
```
若要使用自定义SVG图标，需要将图标文件放入应用的 `public` 目录，然后通过CSS或直接引用路径的方式设置，但这通常需要更深入的前端自定义。

### 3.3 多模块应用
如果一个应用包含多个模块，只需在 `config/desktop.py` 的 `get_data()` 返回列表中添加多个字典即可。每个模块可以有自己的 `config/<module_name>.py` 文件来定义其内容。

### 3.4 链接到自定义页面
如果希望模块链接到一个自定义的页面而非标准的文档列表，可以在 `<module_name>.py` 的 `items` 中使用 `type: "page"`。
```python
{
    "type": "page",
    "name": "custom-library-dashboard",
    "label": _("Dashboard"),
    "description": _("Library Overview Dashboard")
}
```

## 4. 总结步骤

1. **配置桌面图标**：在应用的 `config/desktop.py` 文件中定义 `get_data` 函数，返回模块的基本信息（名称、图标、颜色等）。
2. **配置模块内容**：在 `config/<module_name>.py` 文件中定义 `get_data` 函数，返回该模块主页面显示的项目列表。
3. **设置权限**：在Frappe后台为相应用户角色设置对相关DocType和页面的访问权限。
4. **清除缓存**：修改配置后，需要执行 `bench clear-cache` 命令使更改生效。

完成以上步骤后，安装或更新您的应用，模块图标就会出现在Frappe桌面对应的分类下了。

---

原始链接: https://docs.frappe.io/framework/user/en/guides/app-development/adding-module-icons-on-desktop