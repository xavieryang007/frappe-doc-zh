# 10.17 单一类型文档类型

本文档详细介绍了Frappe框架中的单一类型文档类型（Single Type Doctype），包括其定义、配置和使用方法。

## 1. 定义

在Frappe框架中，**单一类型文档类型**是一种特殊的DocType，其核心特征是：

- **没有关联的数据库表**：与常规DocType（如"客户"）拥有独立的数据库表（如 `tabCustomer`）不同，单一类型DocType没有专属表。
- **单例模式**：整个系统中只存在**唯一一个**该类型的文档实例。这类似于编程中的单例模式。
- **数据存储方式**：所有单一类型DocType的字段数据都统一存储在名为 `tabSingles` 的共享表中。该表的结构包含三个关键列：`doctype`（文档类型名）、`field`（字段名）和 `value`（字段值）。

**主要用途**：
- **保存全局设置**：例如系统的通用配置。
- **作为向导/助手界面**：用于那些不需要管理多个文档记录，但需要通过表单界面进行操作的场景。

## 2. 配置方法

将DocType配置为单一类型非常简单：

1. **在DocType的设置中**：当您通过Frappe框架创建或编辑一个DocType时，在其设置属性或元数据中，将 `is_single` 这个属性的值设置为 `1`（或者在某些界面中勾选"是单一类型"的复选框）。
2. **效果**：一旦设置，框架便会将此DocType识别为单一类型，不再为其创建专属数据库表，所有数据操作将指向 `tabSingles` 表。

## 3. 使用方法

### 3.1 数据存取
- 由于是单例，您无需像操作普通文档那样"新建"或"查询列表"来获取该类型的文档。
- 在代码中，您通常使用Frappe提供的标准API来获取或保存这个唯一的文档实例。

**Python示例**：
```python
# 获取系统设置这个单一类型文档
system_settings = frappe.get_single("System Settings")
# 读取或修改其字段值
some_setting_value = system_settings.some_fieldname
```

**JavaScript示例**：
```javascript
// 在客户端脚本中，通常通过 frappe.model.with_doc 或直接操作当前表单模型来处理单一文档。
```

### 3.2 前端表单
- 在Frappe桌面上，导航到单一类型DocType的菜单项时，会直接打开那个唯一的文档进行编辑，而不是显示一个列表视图。

## 4. 框架内示例

Frappe框架本身内置的单一类型DocType实例：
- **System Settings**：系统设置。
- **Customize Form**：自定义表单功能。

这些都是在实际中使用单一类型DocType的典型代表。

## 5. 重要注意事项

- **性能考虑**：由于所有单一类型DocType的数据都存储在 `tabSingles` 一张表中，对于频繁读写或字段非常多的单一文档，在设计时需考虑性能影响。不过，对于大多数配置类场景，这通常是可接受的。
- **切勿用于需要多个实例的数据模型**：如果您的业务逻辑需要创建和管理多个同类型的文档（如多个"客户"），那么必须使用标准的DocType，而不是单一类型。

## 6. 实现示例

### 6.1 创建单一类型DocType
1. 在Frappe后台创建新的DocType
2. 在DocType设置中，将"Is Single"设置为"Yes"
3. 添加所需的字段（如：配置项1、配置项2等）
4. 保存DocType

### 6.2 在代码中使用
```python
# 获取单一文档实例
my_config = frappe.get_single("My Single Config")

# 读取配置值
config_value = my_config.my_field

# 修改并保存
my_config.my_field = "new value"
my_config.save()
```

## 7. 总结

单一类型文档类型是Frappe框架中用于实现**全局单例配置**和**特殊功能界面**的有效工具。其定义清晰，配置简单（通过设置 `is_single` 属性），在代码中使用标准的文档API进行操作。核心区别在于其数据存储于共享的 `tabSingles` 表而非独立表。

---

原始链接: https://docs.frappe.io/framework/user/en/guides/app-development/single-type-doctype