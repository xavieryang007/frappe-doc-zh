# 10.13 在Javascript中使用HTML模板

## 模板语法

在Frappe的JavaScript API中，通常使用ES6的**模板字符串** 来嵌入HTML和动态变量。

### 基本语法示例

```javascript
let name = "John";
let html_content = `
    <div class="custom-card">
        <h3>Hello, ${name}!</h3>
        <p>欢迎使用Frappe框架。</p>
    </div>
`;
```

## 使用方法

在Frappe中，通常将生成的HTML字符串通过以下方式使用：

### 设置到某个字段或区域

```javascript
// 假设有一个HTML字段叫"custom_html"
cur_frm.set_df_property('custom_html', 'options', html_content);
```

### 动态创建对话框内容

```javascript
let d = new frappe.ui.Dialog({
    title: '自定义对话框',
    fields: [
        {
            fieldtype: 'HTML',
            fieldname: 'custom_html_area',
            options: html_content
        }
    ]
});
d.show();
```

### 直接写入页面元素

```javascript
// 将HTML插入到ID为"content"的元素中
document.getElementById('content').innerHTML = html_content;
```

## 结合Frappe控件

如果模板中包含需要交互的Frappe控件（如按钮、链接），可以使用 `frappe.render` 或事件绑定：

```javascript
let data = { message: "动态内容" };
let template = `
    <button class="btn btn-primary" onclick="alert('${data.message}')">点击我</button>
`;

// 使用Frappe的html字段渲染
cur_frm.add_custom_button(__('自定义按钮'), () => {
    // 处理点击事件
}, "自定义HTML区域");
```

## 注意事项

- **安全性**：如果变量来自用户输入，务必对内容进行转义，避免XSS攻击。
- **性能**：对于复杂的模板，建议使用Frappe提供的标准模板引擎（如Jinja服务端渲染），或考虑使用 `frappe.render_template` 函数。

## 完整示例

以下是一个在Frappe表单脚本中使用的完整示例：

```javascript
frappe.ui.form.on('Your DocType', {
    refresh: function(frm) {
        // 生成HTML模板
        let employee_name = frm.doc.employee_name || "新员工";
        let html_template = `
            <div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px;">
                <h4>欢迎，${employee_name}！</h4>
                <p>您的入职日期是：${frm.doc.joining_date || "未设置"}</p>
                <button class="btn btn-default btn-sm" onclick="alert('欢迎！')">点击欢迎</button>
            </div>
        `;

        // 将HTML设置为字段内容
        frm.set_df_property('custom_html_field', 'options', html_template);
    }
});
```

如果您需要查看官方指南的完整内容（包括更多高级用法和示例），请直接访问原始链接。

---

原始链接: https://docs.frappe.io/framework/user/en/guides/app-development/using-html-templates-in-javascript