# 10.5 向表单添加自定义按钮

## 添加自定义按钮到表单的完整步骤

### 1. **按钮创建**

- **位置**：需要编辑与目标 DocType 关联的 JavaScript 文件（例如，若为"用户"表单，则编辑 `user.js`）。
- **方法**：使用 `frm.add_custom_button()` 在表单的 `refresh` 事件中创建按钮。
- **语法**：

```javascript
frm.add_custom_button(按钮名称, 回调函数, 按钮分组);
```

- `按钮名称`：按钮显示文本（支持国际化 `__()`）。
- `回调函数`：点击按钮时触发的逻辑。
- `按钮分组`（可选）：将按钮归类到特定下拉组（如"工具"）。

### 2. **事件绑定**

在回调函数中定义按钮点击后的行为，例如：

- 显示字段值（`frappe.msgprint`）。
- 跳转到新表单（`frappe.set_route`）。
- 调用服务器端方法（`frappe.call`）。

**示例代码**（为用户表单添加按钮）：

```javascript
frappe.ui.form.on('User', {
    refresh: function(frm) {
        frm.add_custom_button(__('获取用户邮箱'), function() {
            frappe.msgprint(frm.doc.email); // 点击后显示邮箱
        }, __("工具"));
    }
});
```

### 3. **样式定制**

- **默认样式**：按钮自动应用 Frappe 的标准样式（蓝色主题）。
- **自定义样式**：

  - 通过 CSS 类覆盖样式：

  ```css
  .custom-btn-group .btn-custom {
      background-color: #ff6b6b;
      color: white;
      border-radius: 5px;
  }
  ```

  - 在按钮创建后通过 jQuery 添加类：

  ```javascript
  frm.add_custom_button('按钮', function() {
      // 事件逻辑
  }).addClass('btn-custom');
  ```

## 关键注意事项

1. **文件路径**：JS 文件需放在对应 DocType 的路径下（如 `frappe/core/doctype/user/user.js`）。
2. **事件触发**：确保按钮在 `refresh` 事件中添加，以确保表单加载完成后生效。
3. **分组显示**：若指定分组（如 `__("工具")`），按钮将出现在下拉菜单中，避免表单杂乱。

## 完整示例截图

- 按钮位置：位于表单顶部工具栏，分组在"工具"下拉菜单中。
- 效果：点击后弹出当前用户的邮箱地址。

如果需要进一步调整按钮样式或绑定复杂事件（如异步请求），可结合 Frappe 的 Client Script API 实现。

---

原始链接: https://docs.frappe.io/framework/user/en/guides/app-development/adding-custom-button-to-form