# 29.1 后台服务

## 概述

运行一个活跃的Frappe环境需要启动多个系统级服务以及一些Frappe特有的进程。这些服务在开发和生产环境中有不同的管理方式：

- **开发环境**：使用 `Procfile` 进行进程管理
- **生产环境**：使用 `supervisor` 配置进行进程管理

## 系统级进程

这些进程通常在系统层面运行，可能通过Bench或其他Frappe部署管理工具进行配置。

| 服务名称 | 描述 |
|---------|------|
| **MariaDB/PostgreSQL** | 数据库服务 |
| **Redis** | 用于后台工作者的队列和缓存 |
| **NGINX** | 生产环境部署的反向代理服务器 |
| **Supervisor** | 用于Bench非容器化生产部署的进程管理工具 |

## Frappe 进程

这些进程可以通过手动启动或进程管理器（如Supervisor）来管理。它们定义在Frappe的代码库中。

### 1. WSGI 服务器

- **功能**：负责响应发送到Frappe的HTTP请求
- **开发环境**：使用 `bench serve` 或 `bench start` 启动Werkzeug服务器
- **生产环境**：Bench自动配置Gunicorn（在supervisor配置中）

### 2. Redis Worker 进程

- **功能**：在Frappe系统中执行后台任务
- **启动方式**：运行 `bench start` 时自动启动；生产环境通过supervisor配置管理

### 3. 调度器进程

- **功能**：调度Frappe系统中计划任务的后台作业排队
- **启动方式**：运行 `bench start` 时自动启动；生产环境通过supervisor配置管理

## 关键命令与管理

### 开发环境

- **启动所有服务**：`bench start`
- **仅启动WSGI服务器**：`bench serve`
- **重启服务**：`bench restart`

### 生产环境

- 通过 `supervisor` 守护进程管理上述Frappe服务
- 使用 `supervisorctl` 命令进行服务管理
- 配置文件位置：`config/supervisor.conf`

## 配置文件位置

- **开发环境**：`Procfile`
- **生产环境**：`config/supervisor.conf`

## 注意事项

1. 确保MariaDB/PostgreSQL和Redis已正确安装并运行
2. 生产部署时，务必配置NGINX和Supervisor以保证服务稳定
3. 定时任务和后台作业依赖Redis队列，请确保Redis服务可用
4. 开发环境中的进程定义在 `Procfile` 中，生产环境的进程定义在 `supervisor.conf` 中

## 总结

Frappe Bench后台服务包括系统依赖服务（数据库、Redis、NGINX）和Frappe自有进程（WSGI服务器、Worker、调度器）。理解这些服务的功能和管理方式对于维护稳定的Frappe环境至关重要。