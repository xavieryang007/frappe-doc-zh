# 29.2 Bench命令速查表

## 概述

Frappe Bench命令速查表提供了所有常用`bench`命令的快速参考，包括命令说明、语法和常用选项。

## 可打印版本

您可以下载A4尺寸的常用Bench CLI命令速查表：[Bench Cheatsheet v1.1.pdf](https://docs.frappe.io/files/Bench%20Cheatsheet%20v1.1.pdf)，打印后放在桌边随时查阅。

## 通用命令

| 命令 | 说明 | 常用选项 |
|------|------|----------|
| `bench --version` | 显示Bench版本 | - |
| `bench version` | 显示所有应用的版本 | - |
| `bench src` | 显示Bench仓库目录 | - |
| `bench --help` | 显示所有命令及帮助 | - |
| `bench [command] --help` | 显示特定命令的帮助 | - |
| `bench init [bench-name]` | 创建新的Bench（需在Home目录运行） | `--python`, `--ignore-exist`, `--apps_path`, `--frappe-path`, `--frappe-branch`, `--clone-from`, `--verbose` 等 |
| `bench --site [site-name] COMMAND` | 为命令指定站点 | - |
| `bench update` | 拉取Bench仓库和应用更新，运行迁移，构建前端资源 | `--pull`, `--patch`, `--build`, `--bench`, `--requirements`, `--restart-supervisor`, `--no-backup`, `--reset`, `--dev` |
| `bench restart` | 重启所有Bench服务 | - |
| `bench backup` | 备份默认站点（备份路径：`~/frappe-bench/sites/{site}/private/backups/`） | - |
| `bench backup-all-sites` | 备份所有站点 | `--with-files` |
| `bench restore` | 从备份恢复站点 | `--with-private-files`, `--with-public-files` |
| `bench migrate` | 运行数据库迁移、同步表结构、重建前端文件/翻译 | `--rebuild-website` |
| `bench migrate-env [python-version]` | 将虚拟环境迁移到指定Python版本 | - |
| `bench --site [sitename] set-admin-password [password]` | 重置管理员密码 | - |
| `bench destroy-all-sessions` | 销毁所有会话 | - |

## 配置相关命令

| 命令 | 说明 | 子命令/选项示例 |
|------|------|----------------|
| `bench config` | 修改Bench配置 | `auto_update [on/off]`, `dns_multitenant [on/off]`, `http_timeout`, `restart_supervisor_on_update`, `serve_default_site`, `update_bench_on_update` |
| `bench setup` | 设置组件 | `auto-update`, `backups`, `config`, `env`, `nginx`, `procfile`, `production`, `redis`, `socketio`, `sudoers`, `supervisor`, `add-domain`, `firewall`, `ssh-port`, `requirements`（可使用 `--node`, `--python`, `--dev` 单独更新） |
| `bench set-nginx-port [sitename] [port]` | 在生产环境中设置站点的Nginx端口 | - |

## 开发相关命令

| 命令 | 说明 | 示例/选项 |
|------|------|-----------|
| `bench new-app [app-name]` | 创建新应用 | - |
| `bench get-app [repo-link]` | 从Git仓库下载并安装应用 | `--branch [branch-name]` |
| `bench install-app [app-name]` | 安装已存在的应用 | - |
| `bench remove-from-installed-apps [app-name]` | 从已安装应用列表中移除应用 | - |
| `bench uninstall-app [app-name]` | 卸载应用及相关数据（需Bench在运行） | - |
| `bench remove-app [app-name]` | 完全从Bench中移除应用 | - |
| `bench --site [sitename] --force reinstall` | 重新安装站点（清空数据库，谨慎使用） | - |
| `bench new-site [sitename]` | 创建新站点 | `--db-name`, `--db-host`, `--db-port`, `--mariadb-root-username`, `--mariadb-root-password`, `--admin-password`, `--force`, `--source_sql`, `--install-app` |
| `bench use [site]` | 设置默认站点 | - |
| `bench drop-site` | 彻底删除站点及数据库 | `--root-login`, `--root-password` |
| `bench set-config [key] [value]` | 向站点配置文件添加键值对 | - |
| `bench console` | 在Bench虚拟环境中打开IPython控制台 | `--autoreload` |
| `bench execute` | 执行任意应用中的方法 | 例如：`bench execute frappe.utils.scheduler.enqueue_scheduler_events` |
| `bench --site [sitename] mariadb` | 打开SQL控制台 | - |
| `bench --site [sitename] export-fixtures` | 导出应用中定义的fixtures为JSON文件 | `--app [app-name]` |
| `bench run-tests` | 运行测试 | `--app`, `--doctype`, `--test`, `--module`, `--profile` |
| `bench disable-production` | 禁用生产环境 | - |
| `bench serve` | 启动开发服务器（默认端口8000） | `--port`, `--profile`, `--proxy`, `--noreload`, `--nothreading`, `--with-coverage` |

## 调度器命令

| 命令 | 说明 |
|------|------|
| `bench enable-scheduler` | 启用定时任务调度器 |
| `bench doctor` | 获取后台工作进程的诊断信息 |
| `bench show-pending-jobs` | 查看待处理任务 |
| `bench purge-jobs` | 清除所有待处理任务 |

## 数据导入命令

| 命令 | 说明 | 选项 |
|------|------|------|
| `bench data-import` | 从.csv、.xls或.xlsx文件批量导入数据 | `--file`, `--doctype`, `--type [Insert/Update]` |

## 使用提示

1. **自动更新**：使用`bench config auto_update on`启用自动更新
2. **生产环境部署**：使用`bench setup production`配置生产环境
3. **数据库迁移**：`bench migrate`会运行补丁、同步数据库结构、重建前端资源
4. **开发服务器**：`bench serve`启动开发服务器，支持端口自定义和热重载
5. **备份恢复**：定期使用`bench backup-all-sites`备份所有站点，可通过`bench restore`恢复

## 示例使用场景

### 创建新站点并安装ERPNext
```bash
bench new-site mysite.local --admin-password admin123 --install-app erpnext
```

### 从Git仓库获取并安装应用
```bash
bench get-app https://github.com/frappe/erpnext --branch version-14
bench --site mysite.local install-app erpnext
```

### 生产环境配置
```bash
bench setup production
bench setup nginx
bench setup supervisor
```

### 开发调试
```bash
bench serve --port 8000 --noreload
bench console
bench run-tests --app erpnext --doctype "Sales Order"
```

## 总结

Bench命令速查表为Frappe框架的日常开发、部署和维护提供了全面的命令参考。建议熟练掌握常用命令，并根据具体需求选择合适的选项参数。