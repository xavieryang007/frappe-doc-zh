# 先决条件 (Prerequisites)

## 系统要求

- **支持的操作系统**：Linux 发行版（如 Debian/Ubuntu）或 macOS。Windows 用户可通过 WSL 使用 Ubuntu。
- **架构说明**：详细了解 Frappe 架构可参考官方文档中的架构章节。

## 必需软件及版本

安装 Frappe 前，需确保系统中已安装以下软件并满足版本要求：

| 软件 | 最低版本 | 备注 |
|------|-----------|------|
| MariaDB | 10.6.6+ | 开发版推荐 11.3 |
| Python | 3.10+ | 支持 3.10/3.11/3.12 |
| Node.js | 18+ | 也可使用 20 或 22 |
| Redis | 6 | 用于缓存和实时更新 |
| yarn | 1.12+ | JavaScript 依赖管理 |
| pip | 20+ | Python 包管理 |
| wkhtmltopdf | 0.12.5（带 patched qt） | 用于 PDF 生成 |
| cron | - | 用于定时任务（如证书续期、备份） |

## 安装指南（按操作系统）

### 1. macOS

**安装 Xcode 命令行工具**：
```bash
xcode-select --install
```

**安装 Homebrew**：
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

**安装 wkhtmltopdf**：
```bash
curl -L https://github.com/wkhtmltopdf/packaging/releases/download/0.12.6-2/wkhtmltox-0.12.6-2.macos-cocoa.pkg -O
installer -pkg wkhtmltox-0.12.6-2.macos-cocoa.pkg -target ~
```

**通过 Homebrew 安装其他依赖**：
```bash
brew install python@3.12 git redis mariadb@10.6 node@18 postgresql pkg-config mariadb-connector-c
```

**配置 MariaDB**（适用于 Frappe v15.21.0 之前版本）：
- 编辑 `/usr/local/etc/my.cnf`（Intel Mac）或 `/opt/homebrew/etc/my.cnf`（Apple Silicon）。
- 添加以下配置：
  ```ini
  [mysqld]
  character-set-client-handshake = FALSE
  character-set-server = utf8mb4
  collation-server = utf8mb4_unicode_ci
  bind-address = 127.0.0.1
  [mysql]
  default-character-set = utf8mb4
  ```
- 重启服务：`brew services restart mariadb@10.6`

**安装 yarn**：
```bash
npm install -g yarn
```

### 2. Debian/Ubuntu（建议 Debian 12+ 或 Ubuntu 22.04+）

**更新系统并安装基础包**：
```bash
sudo apt update
sudo apt install git python-is-python3 python3-dev python3-pip redis-server libmariadb-dev mariadb-server mariadb-client pkg-config
```

**设置 MariaDB 密码**（若未在安装过程中提示）：
```bash
sudo mariadb-secure-installation
```

**配置 MariaDB**（适用于 Frappe v15.21.0 之前版本）：
- 编辑 `/etc/mysql/my.cnf`，添加与 macOS 相同的配置段。
- 重启服务：`sudo systemctl restart mariadb`

**通过 nvm 安装 Node.js**：
```bash
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash
# 重新打开终端后执行
nvm install 18
node -v  # 验证版本
```

**安装 yarn**：
```bash
npm install -g yarn
```

**安装 wkhtmltopdf**：
```bash
sudo apt install xvfb libfontconfig
# 从 https://wkhtmltopdf.org/downloads.html 下载 deb 包后安装
sudo dpkg -i wkhtmltox_*.deb
```

## 安装 Bench CLI

**通过 pip 安装**：
```bash
pip install frappe-bench
```
- 如遇权限问题，可尝试 `pip install frappe-bench --break-system-packages` 或使用 `virtualenv`。
- 替代方案：使用 uv 并设置别名 `alias bench='uvx --from frappe-bench bench'`。

**验证安装**：
```bash
bench --version
```

**初始化 Bench 环境**：
```bash
cd ~
bench init <目录名>
```

## 注意事项

- **生产环境部署**：建议使用 frappe_docker 进行 Docker 化部署。
- **路径配置**：若 `bench` 命令未找到，需将安装路径加入 `PATH` 环境变量（如 `~/.profile`）。
- **版本兼容性**：务必遵循官方推荐的软件版本，避免兼容性问题。