# 安装 (Installation)

## 系统要求

- **支持的操作系统**：macOS、Debian 12+ 或 Ubuntu 22.04+
- **重要提示**：生产环境或基于 Docker 的开发建议使用 frappe_docker。

## 前置依赖

确保系统中已安装以下软件及对应版本：

| 软件 | 最低版本 | 用途 |
|------|----------|------|
| MariaDB | 10.6.6+（推荐 11.3） | 数据库 |
| Python | 3.10+ | 后端语言 |
| Node.js | 18+ 或 20 | JavaScript 运行时 |
| Redis | 6+ | 缓存和实时更新 |
| yarn | 1.12+ | JS 依赖管理 |
| pip | 20+ | Python 包管理 |
| wkhtmltopdf | 0.12.5（需打补丁的 qt） | PDF 生成 |
| cron | - | 定时任务（如证书续期、备份） |

## macOS 安装步骤

1. **安装 Xcode 命令行工具**  
   ```bash
   xcode-select --install
   ```

2. **安装 Homebrew**  
   ```bash
   /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
   ```

3. **安装 wkhtmltopdf**  
   ```bash
   curl -L https://github.com/wkhtmltopdf/packaging/releases/download/0.12.6-2/wkhtmltox-0.12.6-2.macos-cocoa.pkg -O
   installer -pkg wkhtmltox-0.12.6-2.macos-cocoa.pkg -target ~
   ```

4. **通过 Homebrew 安装其他依赖**  
   ```bash
   brew install python@3.12 git redis mariadb@10.6 node@18 postgresql pkg-config mariadb-connector-c
   ```

5. **配置 MariaDB**  
   - 编辑配置文件（Intel Mac：`/usr/local/etc/my.cnf`；Apple Silicon：`/opt/homebrew/etc/my.cnf`）  
   - 添加以下内容：  
     ```
     [mysqld]
     character-set-client-handshake = FALSE
     character-set-server = utf8mb4
     collation-server = utf8mb4_unicode_ci
     bind-address = 127.0.0.1

     [mysql]
     default-character-set = utf8mb4
     ```
   - 重启 MariaDB：  
     ```bash
     brew services restart mariadb@10.6
     ```

6. **安装 yarn**  
   ```bash
   npm install -g yarn
   ```

## Debian/Ubuntu 安装步骤

1. **更新系统并安装基础工具**  
   ```bash
   sudo apt update
   sudo apt install git python-is-python3 python3-dev python3-pip redis-server libmariadb-dev mariadb-server mariadb-client pkg-config
   ```

2. **安全初始化 MariaDB**（若未提示设置密码）  
   ```bash
   sudo mariadb-secure-installation
   ```

3. **配置 MariaDB**  
   - 编辑 `/etc/mysql/my.cnf`，添加与 macOS 相同的配置项。  
   - 重启服务：  
     ```bash
     sudo systemctl restart mariadb
     ```

4. **通过 nvm 安装 Node.js**  
   ```bash
   curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash
   # 重启终端后执行
   nvm install 18
   node -v  # 验证版本
   ```

5. **安装 yarn**  
   ```bash
   npm install -g yarn
   ```

6. **安装 wkhtmltopdf**  
   ```bash
   sudo apt install xvfb libfontconfig
   # 从 https://wkhtmltopdf.org/downloads.html 下载并安装 .deb 包
   sudo dpkg -i wkhtmltox_*.deb
   ```

## 安装 Bench CLI

1. **通过 pip 安装 bench**  
   ```bash
   pip install frappe-bench
   ```
   - 若出现权限错误，可尝试：  
     ```bash
     pip install frappe-bench --break-system-packages
     ```
   - 或使用 **uv** 安装（推荐替代方案）：  
     ```bash
     curl -LsSf https://astral.sh/uv/install.sh | sh
     # 在 shell 配置文件（如 .bashrc 或 .zshrc）中添加别名：
     echo "alias bench='uvx --from frappe-bench bench'" >> ~/.bashrc
     source ~/.bashrc
     ```

2. **验证安装**  
   ```bash
   bench --version
   ```

3. **初始化 Bench 环境**  
   ```bash
   cd ~
   bench init <目录名>
   ```

## 下一步

安装完成后，您可以：
- 使用 `bench start` 启动开发服务器。
- 参考 Frappe 框架教程创建应用、站点和数据模型（DocType）。

如需更详细的配置或故障排除，请查阅官方文档中的"调试"、"生产部署"等章节。