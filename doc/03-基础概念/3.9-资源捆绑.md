# 资源捆绑

## 概述
资源捆绑是指将开发人员编写的现代前端代码（如ES6+ JavaScript、TypeScript、SASS/Less等）编译、打包并优化成浏览器可以直接理解的JavaScript和CSS文件的过程。

## 支持的资源类型
Frappe的资源捆绑器可以编译多种类型的文件：
- **脚本文件**：`.js`（现代语法）、`.ts`（TypeScript）、`.vue`（Vue单文件组件）
- **样式文件**：`.css`、`.scss`（SASS）、`.sass`、`.styl`（Stylus）、`.less`（Less）

## 关键命令

### 构建资源
在`frappe-bench`目录下执行以下命令编译资源：
```bash
$ bench build
```

若仅构建指定应用，可添加`--apps`参数：
```bash
$ bench build --apps frappe,erpnext
```

### 监听模式（开发时使用）
在开发过程中，可使用监听模式自动重新编译资源：
```bash
$ bench watch
```

该命令会监控文件变化并实时编译。支持按应用监听：
```bash
$ bench watch --apps erpnext
```

## 打包文件规则

### 捆绑文件定义
- 捆绑文件是资源捆绑的**入口点**
- 任何在应用`public`目录下以`.bundle.js`或`.bundle.css`（及其预处理器扩展名）结尾的文件都会被自动识别和打包

### 输出规则
- 编译后的文件会被输出到`/assets/[app名]/dist/`目录下
- 根据类型（js或css）放入相应子文件夹
- 文件名会附加一个基于内容生成的哈希值，用于浏览器缓存更新

**示例**：
- 输入：`public/main.bundle.js`
- 输出：`/assets/myapp/dist/js/main.bundle.[hash].js`

## 使用NPM库
可通过`yarn`安装第三方库，并在代码中直接导入：

### 安装库
```bash
$ cd apps/myapp
$ yarn add dayjs
```

### 在代码中使用
```javascript
// main.bundle.js
import * as dayjs from 'dayjs';
console.log(dayjs());
```

## 在HTML中引入资源
Frappe提供了多种方法来正确引用这些资源：

### 1. 在自定义HTML中引入
使用Jinja模板的`include_script`和`include_style`：
```html
<!-- index.html -->
<head>
  {{ include_style('style.bundle.css') }}
</head>
<body>
  {{ include_script('main.bundle.js') }}
</body>
```

### 2. 在应用界面（/app）中引入
在`hooks.py`中配置：
```python
app_include_js = ['main.bundle.js']
app_include_css = ['style.bundle.css']
```

### 3. 获取资源路径
使用`bundled_asset`方法获取带哈希的资源路径：
```jinja
{{ bundled_asset('main.bundle.js') }}
```

### 4. 懒加载资源（适用于/app界面）
在JavaScript中动态加载：
```javascript
frappe.require('main.bundle.js').then(() => {
  // 资源加载完成后执行
});
```

## 生产模式构建
为优化资源大小，可使用生产模式构建（启用压缩）：
```bash
$ bench build --production
```

## 总结
Frappe的资源捆绑系统为现代前端开发提供了完整的工具链支持。通过自动化的构建流程和灵活的加载方式，使得开发者可以专注于业务逻辑，而无需关心底层的资源管理和优化问题。

---
*原文链接：https://docs.frappe.io/framework/user/en/basics/asset-bundling*