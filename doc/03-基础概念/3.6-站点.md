# 站点

## 概述
在Frappe框架中，每个租户称为一个**站点**，每个站点拥有独立的数据库。站点存放在名为`sites`的目录中，该目录是运行bench命令时的当前工作目录。

## 站点目录结构
站点目录（例如`frappe-bench/sites`）包含以下重要文件和文件夹：

### 主要文件
| 文件/目录 | 说明 |
|-----------|------|
| `apps.txt` | 列出已安装的Frappe应用，使用`bench get-app`或`bench new-app`时自动更新 |
| `common_site_config.json` | 存放所有站点的通用配置 |
| `assets/` | 存放前端资源（JS、CSS、图片等），由`bench build`自动生成，生产环境由Nginx托管 |

### 站点专属目录
每个站点有自己的目录（如`sites/mysite.localhost/`），包含：
```
sites/mysite.localhost/
├── locks/          # 用于任务调度锁文件
├── private/        # 需认证访问的文件（如备份、私有文件）
│   ├── backups/
│   └── files/
├── public/         # 公开访问的文件（通过/files/路径访问）
│   └── files/
├── site_config.json # 站点特定配置
└── task-logs/      # 任务日志
```

## 创建新站点
使用以下命令创建新站点（在`frappe-bench`目录下执行）：
```bash
bench new-site mysite.localhost
```

## 站点配置

### site_config.json
存储站点专属配置（如数据库名、密码等）。配置值可通过`frappe.conf`在代码中访问。

示例配置：
```json
{
  "db_name": "test_frappe",
  "db_password": "test_frappe", 
  "admin_password": "admin"
}
```

## 站点解析与切换

### 站点解析
Frappe根据以下条件自动选择站点：
- HTTP请求的`Host`头匹配站点名
- 请求头`X-Frappe-Site-Name`匹配站点名

### 开发环境指定站点
```bash
bench --site mysite.localhost serve
```

### 设置默认站点
使用以下命令将特定站点设为默认站点：
```bash
bench use mysite.localhost
```

此后可省略`--site`参数运行命令（如`bench migrate`）。

## 关键操作总结

| 操作 | 命令 |
|------|------|
| 创建站点 | `bench new-site <站点名>` |
| 切换默认站点 | `bench use <站点名>` |
| 启动站点服务 | `bench --site <站点名> serve` |
| 运行站点命令 | `bench --site <站点名> migrate` 或（设置默认后）`bench migrate` |

## 文件访问路径

### 用户上传文件
- **公开文件**：存储在`frappe-bench/sites/[sitename]/public/files`，通过`/files/文件名`公开访问
- **私有文件**：存储在`frappe-bench/sites/[sitename]/private/files`，通过`/private/files/文件名`访问，需授权

### 备份文件
- 本地备份存储在`frappe-bench/sites/[sitename]/private/backups`
- 访问URL：`/backups/备份文件名`，需授权下载

## 总结
站点是Frappe框架中多租户架构的核心概念，每个站点拥有独立的数据库和配置文件。通过合理的站点管理，可以在同一套代码基础上运行多个独立的应用实例，实现高效的资源利用和隔离。

---
*原文链接：https://docs.frappe.io/framework/user/en/basics/sites*