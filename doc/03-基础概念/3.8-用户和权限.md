# 用户和权限

## 概述
Frappe框架内置了一套完整的用户认证和权限管理系统，支持用户账户、基于角色的权限控制以及基于Cookie的用户会话管理。

## 主要功能概览

1. **用户 (User)**：代表系统中的认证用户
2. **角色 (Role)**：定义用户对特定文档类型（DocType）可执行的操作
3. **文档类型权限 (DocType Permissions)**：为每个DocType配置默认的访问规则
4. **权限级别 (Permission Level)**：用于对文档中的字段进行分组，并应用不同的角色权限
5. **角色权限管理器 (Role Permissions Manager)**：用于管理角色权限的工具
6. **用户权限 (User Permissions)**：基于特定字段值（如链接字段）对用户进行数据限制
7. **视图和表单限制 (Restricting Views and Forms)**：控制用户可见的模块、文档类型和视图
8. **密码哈希 (Password Hashing)**：自动对密码进行加密存储
9. **密码强度检查 (Password strength checking)**：可配置密码策略
10. **登录尝试限制 (Throttling of login attempts)**：防止暴力破解
11. **第三方认证 (Third party authentication)**：支持OAuth、Google、Facebook等登录方式

## 详细说明

### 1. 用户与角色 (User and Role)
- **用户**可以被分配多个**角色**
- **角色**决定了用户对特定**DocType**拥有哪些权限（如读、写、创建、删除等）
- **示例**：角色"博主"可能对"博客文章"有读、写、创建权限，但对"博客分类"只有读权限

### 2. 文档类型权限 (DocType Permissions)
在DocType的"Permissions"表中可以配置默认角色和权限。可配置的选项包括：

| 选项 | 说明 |
| :--- | :--- |
| **角色** | 应用此权限规则的角色 |
| **权限级别** | 分配给此角色的权限级别 |
| **如果用户是所有者** | 规则仅适用于用户自己创建的文档 |
| **读/写/创建/删除** | 基本的CRUD权限 |
| **提交/取消** | 工作流相关权限 |
| **修改** | 允许用户修改文档 |
| **报告** | 允许查看报告 |
| **导出/导入** | 允许数据导出/导入 |
| **设置用户权限** | 允许用户为其他用户设置权限 |
| **共享** | 允许共享文档 |
| **打印** | 允许打印文档或生成PDF |
| **电子邮件** | 允许发送与该文档相关的电子邮件 |

### 3. 权限级别 (Permission Level)
- 用于对文档中的字段进行分组（默认所有字段的`permlevel`为0）
- 可以为不同的权限级别设置不同的角色访问权限，实现更细粒度的控制

### 4. 角色权限管理器 (Role Permissions Manager)
- 这是一个用户工具，用于查看和管理所有角色的权限
- 可以在此覆盖DocType中设置的默认权限

### 5. 用户权限 (User Permissions)
- 用于实现**行级数据权限**。可以限制用户只能访问特定字段值为某值的文档
- **示例**：限制用户"John"只能查看"作者"字段值为"John"的"博客文章"
- 通过在"用户权限"记录中设置（例如：`For DocType: Blog Post`，`Applicable For: User`，`User: John`，`Document Value: John`）来实现

### 6. 自动角色 (Automatic Roles)
系统有一些预定义的、自动分配的角色：
- **Guest**：分配给所有人，包括未认证用户
- **All**：分配给所有注册用户（包括网站用户）
- **Administrator**：默认仅分配给管理员用户
- **Desk User (v15新增)**：分配给所有用户类型为"系统用户"的用户

### 7. 限制视图和表单 (Restricting Views and Forms)
- **模块限制**：在**用户**表单的"允许模块"部分，可以控制用户能看到哪些模块
- **文档类型隐藏**：通过**角色权限管理器**移除某个角色对DocType的"读"权限，即可对该角色隐藏该DocType
- **页面和报告权限**：使用专门的"页面和报告的角色权限"工具进行控制

### 8. 密码哈希 (Password Hashing)
- 用户密码会被自动加密，并存储在单独的`__Auth`数据库表中，确保安全

### 9. 密码策略 (Password Policy)
- 在**系统设置**的"安全"部分，可以启用密码强度检查
- 通过设置"最低密码分数"来强制要求用户创建强密码

### 10. 登录尝试限制 (Login Attempts)
- 可以配置允许的连续失败登录尝试次数，以及账户被锁定的时间长度，以防止暴力攻击

### 11. 第三方认证 (Third Party Authentication)
- 支持通过配置**社交登录密钥**来集成第三方登录提供商（如Google、Facebook）
- 详细设置方法可参考文档中的"社交登录密钥"部分

## 总结
Frappe框架提供了一个非常全面且灵活的用户和权限管理体系，从基本的角色权限到细粒度的数据行级权限，再到安全策略和第三方集成，都提供了开箱即用的支持。

---
*原文链接：https://docs.frappe.io/framework/user/en/basics/users-and-permissions*