# 配置

## 概述
Frappe使用两种主要配置文件来管理站点和Bench级别的设置：

## 配置文件类型

### 1. site_config.json（站点配置）
- **位置**：位于具体站点的目录下（如`sites/your_site/site_config.json`）
- **作用**：存储**单个站点**的专属配置，例如数据库连接信息、管理员密码等
- **示例内容**：
```json
{
  "db_name": "your_database_name",
  "db_password": "your_db_password",
  "admin_password": "admin_password"
}
```

### 2. common_site_config.json（公共配置）
- **位置**：位于Bench根目录下
- **作用**：存储**所有站点共享**的全局配置，如Redis连接、开发模式开关等
- **示例内容**：
```json
{
  "developer_mode": true,
  "redis_cache": "redis://localhost:13000",
  "webserver_port": 8000
}
```

## 配置优先级规则
- 如果同一个配置项在`site_config.json`和`common_site_config.json`中同时存在，**`site_config.json`的值会覆盖全局配置**
- 例如：在全局开启日志记录，但为某个特定站点关闭日志

## 常用配置项详解

### 必填项（Mandatory Settings）
- `db_type`：数据库类型（如`mariadb`或`postgres`）
- `db_name`：数据库名称
- `db_password`：数据库密码

### 常用可选配置（Optional Settings）
| 配置项 | 说明 |
|--------|------|
| `admin_password` | 默认管理员密码 |
| `developer_mode` | 开发模式（自动重载文档类型变更） |
| `allow_cors` | 允许跨域请求（可设置域名或通配符`*`） |
| `maintenance_mode` | 启用维护模式 |
| `pause_scheduler` | 暂停后台任务调度 |
| `max_file_size` | 上传文件大小限制（默认10MB） |

### 数据库连接高级设置
- **远程数据库SSL连接**：需设置`db_ssl_ca`、`db_ssl_cert`、`db_ssl_key`等路径
- **只读副本数据库**：通过`read_from_replica`、`replica_host`等配置实现读写分离

### 邮件发送配置
- `mail_server`、`mail_port`、`mail_login`、`mail_password`等用于设置SMTP发件服务

## 通过Bench CLI管理配置

### 设置全局配置
```bash
bench config set-common-config -c 配置项名 值
```

### 设置站点专属配置
```bash
bench --site 站点名 set-config 配置项名 值
```

### 显示当前配置
```bash
bench show-config
```

## 扩展配置方式

### 通过环境变量覆盖
- 支持通过环境变量动态覆盖部分配置（优先级最高）
- 例如：`FRAPPE_DB_PASSWORD`会覆盖`db_password`配置

### 自定义Hook
- 可以编写Python方法动态返回配置（如从外部密钥管理服务获取密码）
- 在公共配置中指定一个Python函数，返回需动态加载的配置字典

示例Python代码：
```python
def hook():
    return {"db_password": get_vault_password()}  # 从密钥管理系统读取
```

## 配置文件备份说明
- `site_config.json`会随数据库备份自动保存，丢失可能导致站点无法运行
- 生产环境中建议将关键配置（如数据库密码）通过环境变量或外部Hook管理，避免硬编码

## 完整配置清单
文档中列出的配置项超过70个，涵盖以下方面：
- 数据库配置
- 缓存配置
- 任务队列配置
- 第三方集成（如PayPal、Dropbox）
- 日志配置
- 权限控制配置
- 邮件和短信配置
- 文件上传配置

## 最佳实践

### 开发环境
- 使用`developer_mode: true`启用开发模式
- 配置合适的日志级别便于调试

### 生产环境
- 禁用`developer_mode`
- 配置合适的缓存策略
- 设置文件上传限制
- 配置邮件发送服务

### 安全配置
- 使用强密码和加密连接
- 配置合适的权限控制
- 定期更新密钥和证书

## 总结
Frappe框架的配置系统提供了灵活的配置管理机制，支持从简单的本地配置到复杂的分布式环境配置。通过合理的配置管理，可以确保应用在不同环境下的稳定运行和安全性。

---
*原文链接：https://docs.frappe.io/framework/user/en/basics/site_config*