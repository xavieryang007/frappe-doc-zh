# 28.5 为站点设置限制

## 重要提示
根据官方文档（Version 12起），此功能**已被弃用**。以下指南基于被弃用前的版本（主要是v7）编写，仅供参考和历史背景。在较新版本的Frappe/ERPNext中，限制管理可能通过其他方式（如订阅计划）实现。

## 1. 概述
Frappe框架（v7版本中引入）支持为站点设置各种操作和资源限制。这些限制有助于控制站点的使用规模，例如用户数量、邮件发送量、磁盘空间等。限制配置直接保存在站点的`site_config.json`文件中。

## 2. 配置位置
限制设置在站点目录下的`site_config.json`文件里的`limits`字典中。一个配置了限制的`site_config.json`文件示例如下：

```json
{
  "db_name": "your_database_name",
  "db_password": "your_db_password",
  "limits": {
    "emails": 1500,
    "space": 0.157,
    "expiry": "2016-07-25",
    "users": 1,
    "email_group": 500
  }
}
```

## 3. 可设置的限制类型
您可以设置以下类型的限制：

| 限制键 | 说明 | 示例值 |
| :--- | :--- | :--- |
| **`users`** | 站点允许创建的最大用户数量 | `5` |
| **`emails`** | 站点每月允许发送的最大电子邮件数量 | `1500` |
| **`space`** | 站点允许使用的最大磁盘空间（单位：GB） | `1.5` |
| **`email_group`** | 单个邮件通信组（Email Group）允许添加的最大成员数量 | `500` |
| **`expiry`** | 站点的到期日期（格式：YYYY-MM-DD）。到达此日期后，站点可能会被限制访问 | `"2024-12-31"` |

## 4. 设置限制的方法
主要推荐使用**Bench CLI**工具来设置限制，这比手动编辑配置文件更安全、更方便。

### 设置单个限制
使用`bench set-limit`命令
```bash
bench --site [您的站点名称] set-limit [限制键] [值]
```

**示例**：将站点`site1.local`的最大用户数设置为5
```bash
bench --site site1.local set-limit users 5
```

### 一次性设置多个限制
使用`bench set-limits`命令，可以同时设置多个限制
```bash
bench --site [您的站点名称] set-limits --limit [限制键1] [值1] --limit [限制键2] [值2]
```

**示例**：同时设置用户限制和空间限制
```bash
bench --site site1.local set-limits --limit users 10 --limit space 2.5
```

## 5. 查看限制和用量
设置限制后，您可以在Frappe系统的图形界面中查看当前的资源使用情况

1. 通过**AwesomeBar**（顶部的全局搜索栏）或工具栏导航
2. 搜索并进入**"Usage Info"**（使用情况信息）页面
3. 该页面会清晰列出已配置的各项限制及其当前使用量
   - **注意**：只有在`site_config.json`中明确设置过的限制才会在此页面显示

## 6. 重要注意事项

### 弃用说明
- 此功能自**Frappe Version 12起已被标记为弃用**
- 在新版本的Frappe/ERPNext中，官方可能不再维护或支持通过`site_config.json`设置此类限制
- 对于生产环境，请优先查阅您所用版本的最新官方文档，了解如何进行用量管理和订阅设置

### 生效方式
- 通过Bench命令设置限制后，通常需要**重启Frappe应用服务**才能使更改生效
- 可以使用`bench restart`命令

### 限制的强制执行
- 框架本身会依据这些限制来阻止超额操作（例如，当用户数达到上限时，尝试创建新用户会失败）

## 7. 总结
本指南详细介绍了在Frappe v7中为站点设置资源限制的完整流程，包括可用的限制类型、设置方法（Bench CLI命令）以及查看方式。请务必注意该功能的**弃用状态**，并在新版本中寻求替代方案。