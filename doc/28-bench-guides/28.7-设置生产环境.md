# 28.7 设置生产环境

## 1. 重要提示
- **不建议在裸金属服务器上安装**。推荐使用Docker镜像进行生产环境部署，相关说明请参考：[Frappe GitHub安装指南](https://github.com/frappe/frappe#installation)

## 2. 两种设置方式
- **简易生产设置（推荐）**  
  运行以下命令自动完成配置：  
  ```bash
  sudo bench setup production
  ```

- **手动生产设置**  
  如需手动配置，需分别设置**Supervisor**和**Nginx**

---

## 手动配置步骤

### 3. 配置Supervisor
Supervisor用于监控并确保Frappe系统进程持续运行，崩溃时自动重启

#### 操作步骤：
1. 生成Supervisor配置文件：
   ```bash
   bench setup supervisor
   ```
   - 文件将生成在`config/supervisor.conf`

2. 将配置文件链接到Supervisor目录：
   ```bash
   sudo ln -s $(pwd)/config/supervisor.conf /etc/supervisor/conf.d/frappe-bench.conf
   ```

3. 重新加载Supervisor配置：
   ```bash
   sudo supervisorctl reload
   ```

#### 注意事项：
- 若无需配置Redis，可添加`--skip-redis`参数：  
  `bench setup supervisor --skip-redis`
- **CentOS 7用户**需将文件扩展名改为`.ini`：  
  `sudo ln -s $(pwd)/config/supervisor.conf /etc/supervisor/conf.d/frappe-bench.ini`

### 4. 配置Nginx
Nginx用于代理请求并托管静态资源

#### 操作步骤：
1. 生成Nginx配置文件：
   ```bash
   bench setup nginx
   ```
   - 文件将生成在`config/nginx.conf`

2. 链接配置文件到Nginx目录：
   ```bash
   sudo ln -s $(pwd)/config/nginx.conf /etc/nginx/conf.d/frappe-bench.conf
   ```

3. 检查配置并重启Nginx：
   ```bash
   sudo nginx -t  # 验证配置
   sudo systemctl reload nginx  # 重启服务
   ```

#### 常见问题：
- 若端口80被默认配置占用，需禁用相关文件（如`/etc/nginx/sites-available/default`）

---

## 附加说明
- **自动化重启**：为避免应用更新后需手动重启进程，可配置sudoers：  
  ```bash
  sudo bench setup sudoers $(whoami)
  ```
- **回退到开发环境**：文档中未详细说明，但提及可通过特定命令还原为开发模式

---

如果需要具体操作或命令的详细解释，可进一步查阅相关章节（如"Bench - Guides"中的"Setup Production"）。