# 28.2 é…ç½®HTTPS

## ğŸš€ é…ç½®HTTPSå®Œæ•´æŒ‡å—

### 1. è·å–æ‰€éœ€æ–‡ä»¶
- ä½ éœ€è¦ä»å¯ä¿¡çš„**è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰**è·å–SSLè¯ä¹¦ï¼Œæˆ–ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼ˆè‡ªç­¾åè¯ä¹¦åœ¨æµè§ˆå™¨ä¸­ä¼šæ˜¾ç¤º"ä¸å—ä¿¡ä»»"è­¦å‘Šï¼‰
- æ¨èä½¿ç”¨ **Let's Encrypt** è·å–å…è´¹SSLè¯ä¹¦ï¼ˆæœ‰å•ç‹¬æ•™ç¨‹ï¼‰
- å¿…éœ€æ–‡ä»¶åŒ…æ‹¬ï¼š
  - **è¯ä¹¦æ–‡ä»¶**ï¼ˆé€šå¸¸ä¸º `.crt` æ‰©å±•åï¼‰
  - **è§£å¯†çš„ç§é’¥æ–‡ä»¶**ï¼ˆ`.key`ï¼‰

---

### 2. å‰ææ¡ä»¶
- âœ… å·²é…ç½® **DNS å¤šç§Ÿæˆ·è®¾ç½®**
- âœ… ç«™ç‚¹å¯é€šè¿‡**æœ‰æ•ˆåŸŸå**è®¿é—®
- âœ… ä½ æ‹¥æœ‰æœåŠ¡å™¨çš„ **root æƒé™**
- âœ… å·²ä»å¯ä¿¡CAè·å–æœ‰æ•ˆè¯ä¹¦æˆ–ä½¿ç”¨è‡ªç­¾åè¯ä¹¦

#### ç”ŸæˆCSRï¼ˆå¦‚å°šæœªæœ‰è¯ä¹¦ï¼‰
å¦‚æœä½ éœ€è¦é€šè¿‡ç§æœ‰CAï¼ˆå¦‚GoDaddyã€ComodoSSLï¼‰ç­¾å‘è¯ä¹¦ï¼Œéœ€å…ˆç”ŸæˆCSRï¼ˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼‰å’Œç§é’¥ï¼š
```bash
openssl req -new -newkey rsa:2048 -nodes -keyout mydomain.com.key -out mydomain.com.csr
```
- å°†ç”Ÿæˆçš„ `.csr` æ–‡ä»¶æäº¤ç»™CAï¼Œè·å–ç­¾å‘çš„ `.crt` è¯ä¹¦æ–‡ä»¶

#### åˆå¹¶è¯ä¹¦ï¼ˆå¦‚æœ‰å¤šçº§è¯ä¹¦ï¼‰
å¦‚æœ‰ä¸»è¯ä¹¦å’Œä¸­é—´è¯ä¹¦ï¼Œéœ€åˆå¹¶ï¼š
```bash
cat your_certificate.crt CA.crt >> certificate_bundle.crt
```

#### è®¾ç½®ç§é’¥æƒé™
ç¡®ä¿ç§é’¥ä»…rootå¯è¯»ï¼š
```bash
chown root private.key
chmod 600 private.key
```

---

### 3. å°†è¯ä¹¦å’Œç§é’¥ç§»è‡³å®‰å…¨ç›®å½•
```bash
mkdir -p /etc/nginx/conf.d/ssl
mv private.key /etc/nginx/conf.d/ssl/private.key
mv certificate_bundle.crt /etc/nginx/conf.d/ssl/certificate_bundle.crt
```

---

### 4. é…ç½®Nginx SSLè·¯å¾„
ä½¿ç”¨ `bench` å‘½ä»¤ä¸ºç«™ç‚¹è®¾ç½®è¯ä¹¦å’Œç§é’¥è·¯å¾„ï¼š
```bash
bench set-ssl-certificate site1.local /etc/nginx/conf.d/ssl/certificate_bundle.crt
bench set-ssl-key site1.local /etc/nginx/conf.d/ssl/private.key
```
ï¼ˆå°† `site1.local` æ›¿æ¢ä¸ºä½ çš„ç«™ç‚¹åŸŸåï¼‰

---

### 5. ç”ŸæˆNginxé…ç½®
```bash
bench setup nginx
```

---

### 6. é‡æ–°åŠ è½½Nginx
æ ¹æ®ä½ çš„ç³»ç»Ÿé€‰æ‹©ç›¸åº”å‘½ä»¤ï¼š
```bash
# Ubuntu/Debian
sudo service nginx reload

# CentOS 7+
systemctl reload nginx
```

---

### âœ… å®Œæˆï¼
é…ç½®å®Œæˆåï¼Œæ‰€æœ‰HTTPè¯·æ±‚å°†è¢«è‡ªåŠ¨é‡å®šå‘åˆ°HTTPS

---

## ğŸ’¡ é™„æ³¨
- è‹¥ä½¿ç”¨ **Let's Encrypt**ï¼Œå¯å‚è€ƒã€Šä½¿ç”¨Let's Encryptè®¾ç½®HTTPSã€‹æ•™ç¨‹ç®€åŒ–è¯ä¹¦è·å–è¿‡ç¨‹
- ç¡®ä¿Nginxé…ç½®æ­£ç¡®ï¼Œé¿å…è¯ä¹¦è·¯å¾„é”™è¯¯å¯¼è‡´HTTPSå¤±æ•ˆ

å¦‚æœéœ€è¦æ›´è¯¦ç»†çš„Let's Encrypté…ç½®æŒ‡å—æˆ–å…¶ä»–è¿›é˜¶è®¾ç½®ï¼Œè¯·å‘ŠçŸ¥ï¼Œæˆ‘å¯ä»¥è¿›ä¸€æ­¥æä¾›ç›¸åº”å†…å®¹